var hdf5=(()=>{var e=Object.defineProperty,t=(t,i,s)=>(((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(t,"symbol"!=typeof i?i+"":i,s),s),i={};function s(e,t,i=0){var s=new Map;for(let[a,r]of e.entries()){let e=h.unpack_from("<"+r,t,i);i+=h.calcsize(r),1==e.length&&(e=e[0]),s.set(a,e)}return s}function a(e){e||e()}function r(e){var t="<"+Array.from(e.values()).join("");return h.calcsize(t)}function n(e,t=8){return Math.ceil(e/t)*t}((t,i)=>{for(var s in(t=>{e(t,"__esModule",{value:!0})})(t),i)e(t,s,{get:i[s],enumerable:!0})})(i,{Dataset:()=>Ts,File:()=>Cs,Filters:()=>yi,Group:()=>Us});var o={u:"Uint",i:"Int",f:"Float"};function l(e){var t,i,s=h._is_big_endian(e);if(/S/.test(e))t="getString",i=0|((e.match(/S(\d*)/)||[])[1]||1);else{let[s,a,r]=e.match(/[<>=!@]?(i|u|f)(\d*)/);i=parseInt(r||4,10),t="get"+o[a]+(8*i).toFixed()}return[t,s,i]}var h=new class{constructor(){this.big_endian=function(){const e=new Uint8Array(4);return!((new Uint32Array(e.buffer)[0]=1)&e[0])}(),this.getters={s:"getUint8",b:"getInt8",B:"getUint8",h:"getInt16",H:"getUint16",i:"getInt32",I:"getUint32",l:"getInt32",L:"getUint32",q:"getInt64",Q:"getUint64",f:"getFloat32",d:"getFloat64"},this.byte_lengths={s:1,b:1,B:1,h:2,H:2,i:4,I:4,l:4,L:4,q:8,Q:8,f:4,d:8};let e=Object.keys(this.byte_lengths).join("");this.fmt_size_regex="(\\d*)(["+e+"])"}calcsize(e){for(var t,i=0,s=new RegExp(this.fmt_size_regex,"g");null!==(t=s.exec(e));){let e=parseInt(t[1]||1,10),s=t[2];i+=e*this.byte_lengths[s]}return i}_is_big_endian(e){return!/^</.test(e)&&(!!/^(!|>)/.test(e)||this.big_endian)}unpack_from(e,t,i){i=Number(i||0);for(var s,a=new _(t,0),r=[],n=this._is_big_endian(e),o=new RegExp(this.fmt_size_regex,"g");null!==(s=o.exec(e));){let e=parseInt(s[1]||1,10),o=s[2],h=this.getters[o],_=this.byte_lengths[o];if("s"==o)r.push((new TextDecoder).decode(t.slice(i,i+e))),i+=e;else for(var l=0;l<e;l++)r.push(a[h](i,!n)),i+=_}return r}};var _=class extends DataView{getUint64(e,t){const i=BigInt(this.getUint32(e,t)),s=BigInt(this.getUint32(e+4,t));let a=t?i+(s<<32n):(i<<32n)+s;return Number(a)}getInt64(e,t){var i,s;t?(i=this.getUint32(e,!0),s=this.getInt32(e+4,!0)):(s=this.getInt32(e,!1),i=this.getUint32(e+4,!1));let a=BigInt(i)+(BigInt(s)<<32n);return Number(a)}getString(e,t,i){const s=this.buffer.slice(e,e+i);return(new TextDecoder).decode(s)}getVLENStruct(e,t,i){return[this.getUint32(e,t),this.getUint64(e+4,t),this.getUint32(e+12,t)]}};function d(e){return e.toString(2).length}function c(e,t,i=0,s=!0){let a=new Uint8Array(t.slice(i,i+e));return s||a.reverse(),a.reduce(((e,t,i)=>e+(t<<8*i)),0)}var f=class{constructor(e,t){this.buf=e,this.offset=t,this.dtype=this.determine_dtype()}determine_dtype(){let e=s(u,this.buf,this.offset);this.offset+=g;let t=15&e.get("class_and_version");if(t==p)return this._determine_dtype_fixed_point(e);if(t==m)return this._determine_dtype_floating_point(e);if(t==b)throw"Time datatype class not supported.";if(t==w)return this._determine_dtype_string(e);if(t==v)throw"Bitfield datatype class not supported.";if(t==k)throw"Opaque datatype class not supported.";if(t==y)return this._determine_dtype_compound(e);if(t==x)return["REFERENCE",e.get("size")];if(t==z)return this.determine_dtype();if(t==B)throw"Array datatype class not supported.";if(t==E){let t=this._determine_dtype_vlen(e);if("VLEN_SEQUENCE"==t[0]){t=["VLEN_SEQUENCE",this.determine_dtype()]}return t}throw"Invalid datatype class "+t}_determine_dtype_fixed_point(e){let t=e.get("size");if(![1,2,4,8].includes(t))throw"Unsupported datatype size";var i;var s;return i=(8&e.get("class_bit_field_0"))>0?"i":"u",s=0==(1&e.get("class_bit_field_0"))?"<":">",this.offset+=4,s+i+t.toFixed()}_determine_dtype_floating_point(e){let t=e.get("size");if(![1,2,4,8].includes(t))throw"Unsupported datatype size";var i;return i=0==(1&e.get("class_bit_field_0"))?"<":">",this.offset+=12,i+"f"+t.toFixed()}_determine_dtype_string(e){return"S"+e.get("size").toFixed()}_determine_dtype_vlen(e){return 1!=(1&e.get("class_bit_field_0"))?["VLEN_SEQUENCE",0,0]:["VLEN_STRING",e.get("class_bit_field_0")>>4,1&e.get("class_bit_field_1")]}_determine_dtype_compound(e){throw"Compound type not yet implemented!"}},u=new Map([["class_and_version","B"],["class_bit_field_0","B"],["class_bit_field_1","B"],["class_bit_field_2","B"],["size","I"]]),g=r(u),p=(r(new Map([["offset","I"],["dimensionality","B"],["reserved_0","B"],["reserved_1","B"],["reserved_2","B"],["permutation","I"],["reserved_3","I"],["dim_size_1","I"],["dim_size_2","I"],["dim_size_3","I"],["dim_size_4","I"]])),0),m=1,b=2,w=3,v=4,k=5,y=6,x=7,z=8,E=9,B=10;function S(e){let t=e.length;for(;--t>=0;)e[t]=0}var A=256,I=286,R=30,M=15,N=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),U=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),D=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),C=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),T=new Array(576);S(T);var F=new Array(60);S(F);var L=new Array(512);S(L);var j=new Array(256);S(j);var O=new Array(29);S(O);var H,Q,Z,P=new Array(R);function K(e,t,i,s,a){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=s,this.max_length=a,this.has_stree=e&&e.length}function V(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}S(P);var G=e=>e<256?L[e]:L[256+(e>>>7)],W=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},q=(e,t,i)=>{e.bi_valid>16-i?(e.bi_buf|=t<<e.bi_valid&65535,W(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)},Y=(e,t,i)=>{q(e,i[2*t],i[2*t+1])},$=(e,t)=>{let i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1},X=(e,t,i)=>{const s=new Array(16);let a,r,n=0;for(a=1;a<=M;a++)s[a]=n=n+i[a-1]<<1;for(r=0;r<=t;r++){let t=e[2*r+1];0!==t&&(e[2*r]=$(s[t]++,t))}},J=e=>{let t;for(t=0;t<I;t++)e.dyn_ltree[2*t]=0;for(t=0;t<R;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0},ee=e=>{e.bi_valid>8?W(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},te=(e,t,i,s)=>{const a=2*t,r=2*i;return e[a]<e[r]||e[a]===e[r]&&s[t]<=s[i]},ie=(e,t,i)=>{const s=e.heap[i];let a=i<<1;for(;a<=e.heap_len&&(a<e.heap_len&&te(t,e.heap[a+1],e.heap[a],e.depth)&&a++,!te(t,s,e.heap[a],e.depth));)e.heap[i]=e.heap[a],i=a,a<<=1;e.heap[i]=s},se=(e,t,i)=>{let s,a,r,n,o=0;if(0!==e.last_lit)do{s=e.pending_buf[e.d_buf+2*o]<<8|e.pending_buf[e.d_buf+2*o+1],a=e.pending_buf[e.l_buf+o],o++,0===s?Y(e,a,t):(r=j[a],Y(e,r+A+1,t),n=N[r],0!==n&&(a-=O[r],q(e,a,n)),s--,r=G(s),Y(e,r,i),n=U[r],0!==n&&(s-=P[r],q(e,s,n)))}while(o<e.last_lit);Y(e,256,t)},ae=(e,t)=>{const i=t.dyn_tree,s=t.stat_desc.static_tree,a=t.stat_desc.has_stree,r=t.stat_desc.elems;let n,o,l,h=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<r;n++)0!==i[2*n]?(e.heap[++e.heap_len]=h=n,e.depth[n]=0):i[2*n+1]=0;for(;e.heap_len<2;)l=e.heap[++e.heap_len]=h<2?++h:0,i[2*l]=1,e.depth[l]=0,e.opt_len--,a&&(e.static_len-=s[2*l+1]);for(t.max_code=h,n=e.heap_len>>1;n>=1;n--)ie(e,i,n);l=r;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ie(e,i,1),o=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=o,i[2*l]=i[2*n]+i[2*o],e.depth[l]=(e.depth[n]>=e.depth[o]?e.depth[n]:e.depth[o])+1,i[2*n+1]=i[2*o+1]=l,e.heap[1]=l++,ie(e,i,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const i=t.dyn_tree,s=t.max_code,a=t.stat_desc.static_tree,r=t.stat_desc.has_stree,n=t.stat_desc.extra_bits,o=t.stat_desc.extra_base,l=t.stat_desc.max_length;let h,_,d,c,f,u,g=0;for(c=0;c<=M;c++)e.bl_count[c]=0;for(i[2*e.heap[e.heap_max]+1]=0,h=e.heap_max+1;h<573;h++)_=e.heap[h],c=i[2*i[2*_+1]+1]+1,c>l&&(c=l,g++),i[2*_+1]=c,_>s||(e.bl_count[c]++,f=0,_>=o&&(f=n[_-o]),u=i[2*_],e.opt_len+=u*(c+f),r&&(e.static_len+=u*(a[2*_+1]+f)));if(0!==g){do{for(c=l-1;0===e.bl_count[c];)c--;e.bl_count[c]--,e.bl_count[c+1]+=2,e.bl_count[l]--,g-=2}while(g>0);for(c=l;0!==c;c--)for(_=e.bl_count[c];0!==_;)d=e.heap[--h],d>s||(i[2*d+1]!==c&&(e.opt_len+=(c-i[2*d+1])*i[2*d],i[2*d+1]=c),_--)}})(e,t),X(i,h,e.bl_count)},re=(e,t,i)=>{let s,a,r=-1,n=t[1],o=0,l=7,h=4;for(0===n&&(l=138,h=3),t[2*(i+1)+1]=65535,s=0;s<=i;s++)a=n,n=t[2*(s+1)+1],++o<l&&a===n||(o<h?e.bl_tree[2*a]+=o:0!==a?(a!==r&&e.bl_tree[2*a]++,e.bl_tree[32]++):o<=10?e.bl_tree[34]++:e.bl_tree[36]++,o=0,r=a,0===n?(l=138,h=3):a===n?(l=6,h=3):(l=7,h=4))},ne=(e,t,i)=>{let s,a,r=-1,n=t[1],o=0,l=7,h=4;for(0===n&&(l=138,h=3),s=0;s<=i;s++)if(a=n,n=t[2*(s+1)+1],!(++o<l&&a===n)){if(o<h)do{Y(e,a,e.bl_tree)}while(0!=--o);else 0!==a?(a!==r&&(Y(e,a,e.bl_tree),o--),Y(e,16,e.bl_tree),q(e,o-3,2)):o<=10?(Y(e,17,e.bl_tree),q(e,o-3,3)):(Y(e,18,e.bl_tree),q(e,o-11,7));o=0,r=a,0===n?(l=138,h=3):a===n?(l=6,h=3):(l=7,h=4)}},oe=!1,le=(e,t,i,s)=>{q(e,0+(s?1:0),3),((e,t,i,s)=>{ee(e),s&&(W(e,i),W(e,~i)),e.pending_buf.set(e.window.subarray(t,t+i),e.pending),e.pending+=i})(e,t,i,!0)},he={_tr_init:e=>{oe||((()=>{let e,t,i,s,a;const r=new Array(16);for(i=0,s=0;s<28;s++)for(O[s]=i,e=0;e<1<<N[s];e++)j[i++]=s;for(j[i-1]=s,a=0,s=0;s<16;s++)for(P[s]=a,e=0;e<1<<U[s];e++)L[a++]=s;for(a>>=7;s<R;s++)for(P[s]=a<<7,e=0;e<1<<U[s]-7;e++)L[256+a++]=s;for(t=0;t<=M;t++)r[t]=0;for(e=0;e<=143;)T[2*e+1]=8,e++,r[8]++;for(;e<=255;)T[2*e+1]=9,e++,r[9]++;for(;e<=279;)T[2*e+1]=7,e++,r[7]++;for(;e<=287;)T[2*e+1]=8,e++,r[8]++;for(X(T,287,r),e=0;e<R;e++)F[2*e+1]=5,F[2*e]=$(e,5);H=new K(T,N,257,I,M),Q=new K(F,U,0,R,M),Z=new K(new Array(0),D,0,19,7)})(),oe=!0),e.l_desc=new V(e.dyn_ltree,H),e.d_desc=new V(e.dyn_dtree,Q),e.bl_desc=new V(e.bl_tree,Z),e.bi_buf=0,e.bi_valid=0,J(e)},_tr_stored_block:le,_tr_flush_block:(e,t,i,s)=>{let a,r,n=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<A;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),ae(e,e.l_desc),ae(e,e.d_desc),n=(e=>{let t;for(re(e,e.dyn_ltree,e.l_desc.max_code),re(e,e.dyn_dtree,e.d_desc.max_code),ae(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*C[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),a=e.opt_len+3+7>>>3,r=e.static_len+3+7>>>3,r<=a&&(a=r)):a=r=i+5,i+4<=a&&-1!==t?le(e,t,i,s):4===e.strategy||r===a?(q(e,2+(s?1:0),3),se(e,T,F)):(q(e,4+(s?1:0),3),((e,t,i,s)=>{let a;for(q(e,t-257,5),q(e,i-1,5),q(e,s-4,4),a=0;a<s;a++)q(e,e.bl_tree[2*C[a]+1],3);ne(e,e.dyn_ltree,t-1),ne(e,e.dyn_dtree,i-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,n+1),se(e,e.dyn_ltree,e.dyn_dtree)),J(e),s&&ee(e)},_tr_tally:(e,t,i)=>(e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(j[i]+A+1)]++,e.dyn_dtree[2*G(t)]++),e.last_lit===e.lit_bufsize-1),_tr_align:e=>{q(e,2,3),Y(e,256,T),(e=>{16===e.bi_valid?(W(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}},_e=(e,t,i,s)=>{let a=65535&e|0,r=e>>>16&65535|0,n=0;for(;0!==i;){n=i>2e3?2e3:i,i-=n;do{a=a+t[s++]|0,r=r+a|0}while(--n);a%=65521,r%=65521}return a|r<<16|0},de=new Uint32Array((()=>{let e,t=[];for(var i=0;i<256;i++){e=i;for(var s=0;s<8;s++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t})()),ce=(e,t,i,s)=>{const a=de,r=s+i;e^=-1;for(let i=s;i<r;i++)e=e>>>8^a[255&(e^t[i])];return-1^e},fe={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},ue={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},{_tr_init:ge,_tr_stored_block:pe,_tr_flush_block:me,_tr_tally:be,_tr_align:we}=he,{Z_NO_FLUSH:ve,Z_PARTIAL_FLUSH:ke,Z_FULL_FLUSH:ye,Z_FINISH:xe,Z_BLOCK:ze,Z_OK:Ee,Z_STREAM_END:Be,Z_STREAM_ERROR:Se,Z_DATA_ERROR:Ae,Z_BUF_ERROR:Ie,Z_DEFAULT_COMPRESSION:Re,Z_FILTERED:Me,Z_HUFFMAN_ONLY:Ne,Z_RLE:Ue,Z_FIXED:De,Z_DEFAULT_STRATEGY:Ce,Z_UNKNOWN:Te,Z_DEFLATED:Fe}=ue,Le=258,je=262,Oe=103,He=113,Qe=666,Ze=(e,t)=>(e.msg=fe[t],t),Pe=e=>(e<<1)-(e>4?9:0),Ke=e=>{let t=e.length;for(;--t>=0;)e[t]=0},Ve=(e,t,i)=>(t<<e.hash_shift^i)&e.hash_mask,Ge=e=>{const t=e.state;let i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+i),e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))},We=(e,t)=>{me(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Ge(e.strm)},qe=(e,t)=>{e.pending_buf[e.pending++]=t},Ye=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},$e=(e,t,i,s)=>{let a=e.avail_in;return a>s&&(a=s),0===a?0:(e.avail_in-=a,t.set(e.input.subarray(e.next_in,e.next_in+a),i),1===e.state.wrap?e.adler=_e(e.adler,t,a,i):2===e.state.wrap&&(e.adler=ce(e.adler,t,a,i)),e.next_in+=a,e.total_in+=a,a)},Xe=(e,t)=>{let i,s,a=e.max_chain_length,r=e.strstart,n=e.prev_length,o=e.nice_match;const l=e.strstart>e.w_size-je?e.strstart-(e.w_size-je):0,h=e.window,_=e.w_mask,d=e.prev,c=e.strstart+Le;let f=h[r+n-1],u=h[r+n];e.prev_length>=e.good_match&&(a>>=2),o>e.lookahead&&(o=e.lookahead);do{if(i=t,h[i+n]===u&&h[i+n-1]===f&&h[i]===h[r]&&h[++i]===h[r+1]){r+=2,i++;do{}while(h[++r]===h[++i]&&h[++r]===h[++i]&&h[++r]===h[++i]&&h[++r]===h[++i]&&h[++r]===h[++i]&&h[++r]===h[++i]&&h[++r]===h[++i]&&h[++r]===h[++i]&&r<c);if(s=Le-(c-r),r=c-Le,s>n){if(e.match_start=t,n=s,s>=o)break;f=h[r+n-1],u=h[r+n]}}}while((t=d[t&_])>l&&0!=--a);return n<=e.lookahead?n:e.lookahead},Je=e=>{const t=e.w_size;let i,s,a,r,n;do{if(r=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-je)){e.window.set(e.window.subarray(t,t+t),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,s=e.hash_size,i=s;do{a=e.head[--i],e.head[i]=a>=t?a-t:0}while(--s);s=t,i=s;do{a=e.prev[--i],e.prev[i]=a>=t?a-t:0}while(--s);r+=t}if(0===e.strm.avail_in)break;if(s=$e(e.strm,e.window,e.strstart+e.lookahead,r),e.lookahead+=s,e.lookahead+e.insert>=3)for(n=e.strstart-e.insert,e.ins_h=e.window[n],e.ins_h=Ve(e,e.ins_h,e.window[n+1]);e.insert&&(e.ins_h=Ve(e,e.ins_h,e.window[n+3-1]),e.prev[n&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=n,n++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<je&&0!==e.strm.avail_in)},et=(e,t)=>{let i,s;for(;;){if(e.lookahead<je){if(Je(e),e.lookahead<je&&t===ve)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=Ve(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-je&&(e.match_length=Xe(e,i)),e.match_length>=3)if(s=be(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=Ve(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=Ve(e,e.ins_h,e.window[e.strstart+1]);else s=be(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(s&&(We(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===xe?(We(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(We(e,!1),0===e.strm.avail_out)?1:2},tt=(e,t)=>{let i,s,a;for(;;){if(e.lookahead<je){if(Je(e),e.lookahead<je&&t===ve)return 1;if(0===e.lookahead)break}if(i=0,e.lookahead>=3&&(e.ins_h=Ve(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-je&&(e.match_length=Xe(e,i),e.match_length<=5&&(e.strategy===Me||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){a=e.strstart+e.lookahead-3,s=be(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=a&&(e.ins_h=Ve(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,s&&(We(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(s=be(e,0,e.window[e.strstart-1]),s&&We(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(s=be(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===xe?(We(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(We(e,!1),0===e.strm.avail_out)?1:2};function it(e,t,i,s,a){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=s,this.func=a}var st=[new it(0,0,0,0,((e,t)=>{let i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Je(e),0===e.lookahead&&t===ve)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;const s=e.block_start+i;if((0===e.strstart||e.strstart>=s)&&(e.lookahead=e.strstart-s,e.strstart=s,We(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-je&&(We(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===xe?(We(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(We(e,!1),e.strm.avail_out),1)})),new it(4,4,8,4,et),new it(4,5,16,8,et),new it(4,6,32,32,et),new it(4,4,16,16,tt),new it(8,16,32,32,tt),new it(8,16,128,128,tt),new it(8,32,128,256,tt),new it(32,128,258,1024,tt),new it(32,258,258,4096,tt)];function at(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Fe,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),Ke(this.dyn_ltree),Ke(this.dyn_dtree),Ke(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),Ke(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),Ke(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}var rt=e=>{if(!e||!e.state)return Ze(e,Se);e.total_in=e.total_out=0,e.data_type=Te;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?42:He,e.adler=2===t.wrap?0:1,t.last_flush=ve,ge(t),Ee},nt=e=>{const t=rt(e);var i;return t===Ee&&((i=e.state).window_size=2*i.w_size,Ke(i.head),i.max_lazy_match=st[i.level].max_lazy,i.good_match=st[i.level].good_length,i.nice_match=st[i.level].nice_length,i.max_chain_length=st[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0),t},ot=(e,t,i,s,a,r)=>{if(!e)return Se;let n=1;if(t===Re&&(t=6),s<0?(n=0,s=-s):s>15&&(n=2,s-=16),a<1||a>9||i!==Fe||s<8||s>15||t<0||t>9||r<0||r>De)return Ze(e,Se);8===s&&(s=9);const o=new at;return e.state=o,o.strm=e,o.wrap=n,o.gzhead=null,o.w_bits=s,o.w_size=1<<o.w_bits,o.w_mask=o.w_size-1,o.hash_bits=a+7,o.hash_size=1<<o.hash_bits,o.hash_mask=o.hash_size-1,o.hash_shift=~~((o.hash_bits+3-1)/3),o.window=new Uint8Array(2*o.w_size),o.head=new Uint16Array(o.hash_size),o.prev=new Uint16Array(o.w_size),o.lit_bufsize=1<<a+6,o.pending_buf_size=4*o.lit_bufsize,o.pending_buf=new Uint8Array(o.pending_buf_size),o.d_buf=1*o.lit_bufsize,o.l_buf=3*o.lit_bufsize,o.level=t,o.strategy=r,o.method=i,nt(e)},lt={deflateInit:(e,t)=>ot(e,t,Fe,15,8,Ce),deflateInit2:ot,deflateReset:nt,deflateResetKeep:rt,deflateSetHeader:(e,t)=>e&&e.state?2!==e.state.wrap?Se:(e.state.gzhead=t,Ee):Se,deflate:(e,t)=>{let i,s;if(!e||!e.state||t>ze||t<0)return e?Ze(e,Se):Se;const a=e.state;if(!e.output||!e.input&&0!==e.avail_in||a.status===Qe&&t!==xe)return Ze(e,0===e.avail_out?Ie:Se);a.strm=e;const r=a.last_flush;if(a.last_flush=t,42===a.status)if(2===a.wrap)e.adler=0,qe(a,31),qe(a,139),qe(a,8),a.gzhead?(qe(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),qe(a,255&a.gzhead.time),qe(a,a.gzhead.time>>8&255),qe(a,a.gzhead.time>>16&255),qe(a,a.gzhead.time>>24&255),qe(a,9===a.level?2:a.strategy>=Ne||a.level<2?4:0),qe(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(qe(a,255&a.gzhead.extra.length),qe(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=ce(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69):(qe(a,0),qe(a,0),qe(a,0),qe(a,0),qe(a,0),qe(a,9===a.level?2:a.strategy>=Ne||a.level<2?4:0),qe(a,3),a.status=He);else{let t=Fe+(a.w_bits-8<<4)<<8,i=-1;i=a.strategy>=Ne||a.level<2?0:a.level<6?1:6===a.level?2:3,t|=i<<6,0!==a.strstart&&(t|=32),t+=31-t%31,a.status=He,Ye(a,t),0!==a.strstart&&(Ye(a,e.adler>>>16),Ye(a,65535&e.adler)),e.adler=1}if(69===a.status)if(a.gzhead.extra){for(i=a.pending;a.gzindex<(65535&a.gzhead.extra.length)&&(a.pending!==a.pending_buf_size||(a.gzhead.hcrc&&a.pending>i&&(e.adler=ce(e.adler,a.pending_buf,a.pending-i,i)),Ge(e),i=a.pending,a.pending!==a.pending_buf_size));)qe(a,255&a.gzhead.extra[a.gzindex]),a.gzindex++;a.gzhead.hcrc&&a.pending>i&&(e.adler=ce(e.adler,a.pending_buf,a.pending-i,i)),a.gzindex===a.gzhead.extra.length&&(a.gzindex=0,a.status=73)}else a.status=73;if(73===a.status)if(a.gzhead.name){i=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>i&&(e.adler=ce(e.adler,a.pending_buf,a.pending-i,i)),Ge(e),i=a.pending,a.pending===a.pending_buf_size)){s=1;break}s=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,qe(a,s)}while(0!==s);a.gzhead.hcrc&&a.pending>i&&(e.adler=ce(e.adler,a.pending_buf,a.pending-i,i)),0===s&&(a.gzindex=0,a.status=91)}else a.status=91;if(91===a.status)if(a.gzhead.comment){i=a.pending;do{if(a.pending===a.pending_buf_size&&(a.gzhead.hcrc&&a.pending>i&&(e.adler=ce(e.adler,a.pending_buf,a.pending-i,i)),Ge(e),i=a.pending,a.pending===a.pending_buf_size)){s=1;break}s=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,qe(a,s)}while(0!==s);a.gzhead.hcrc&&a.pending>i&&(e.adler=ce(e.adler,a.pending_buf,a.pending-i,i)),0===s&&(a.status=Oe)}else a.status=Oe;if(a.status===Oe&&(a.gzhead.hcrc?(a.pending+2>a.pending_buf_size&&Ge(e),a.pending+2<=a.pending_buf_size&&(qe(a,255&e.adler),qe(a,e.adler>>8&255),e.adler=0,a.status=He)):a.status=He),0!==a.pending){if(Ge(e),0===e.avail_out)return a.last_flush=-1,Ee}else if(0===e.avail_in&&Pe(t)<=Pe(r)&&t!==xe)return Ze(e,Ie);if(a.status===Qe&&0!==e.avail_in)return Ze(e,Ie);if(0!==e.avail_in||0!==a.lookahead||t!==ve&&a.status!==Qe){let i=a.strategy===Ne?((e,t)=>{let i;for(;;){if(0===e.lookahead&&(Je(e),0===e.lookahead)){if(t===ve)return 1;break}if(e.match_length=0,i=be(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(We(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===xe?(We(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(We(e,!1),0===e.strm.avail_out)?1:2})(a,t):a.strategy===Ue?((e,t)=>{let i,s,a,r;const n=e.window;for(;;){if(e.lookahead<=Le){if(Je(e),e.lookahead<=Le&&t===ve)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(a=e.strstart-1,s=n[a],s===n[++a]&&s===n[++a]&&s===n[++a])){r=e.strstart+Le;do{}while(s===n[++a]&&s===n[++a]&&s===n[++a]&&s===n[++a]&&s===n[++a]&&s===n[++a]&&s===n[++a]&&s===n[++a]&&a<r);e.match_length=Le-(r-a),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(i=be(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=be(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(We(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===xe?(We(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(We(e,!1),0===e.strm.avail_out)?1:2})(a,t):st[a.level].func(a,t);if(3!==i&&4!==i||(a.status=Qe),1===i||3===i)return 0===e.avail_out&&(a.last_flush=-1),Ee;if(2===i&&(t===ke?we(a):t!==ze&&(pe(a,0,0,!1),t===ye&&(Ke(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),Ge(e),0===e.avail_out))return a.last_flush=-1,Ee}return t!==xe?Ee:a.wrap<=0?Be:(2===a.wrap?(qe(a,255&e.adler),qe(a,e.adler>>8&255),qe(a,e.adler>>16&255),qe(a,e.adler>>24&255),qe(a,255&e.total_in),qe(a,e.total_in>>8&255),qe(a,e.total_in>>16&255),qe(a,e.total_in>>24&255)):(Ye(a,e.adler>>>16),Ye(a,65535&e.adler)),Ge(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?Ee:Be)},deflateEnd:e=>{if(!e||!e.state)return Se;const t=e.state.status;return 42!==t&&69!==t&&73!==t&&91!==t&&t!==Oe&&t!==He&&t!==Qe?Ze(e,Se):(e.state=null,t===He?Ze(e,Ae):Ee)},deflateSetDictionary:(e,t)=>{let i=t.length;if(!e||!e.state)return Se;const s=e.state,a=s.wrap;if(2===a||1===a&&42!==s.status||s.lookahead)return Se;if(1===a&&(e.adler=_e(e.adler,t,i,0)),s.wrap=0,i>=s.w_size){0===a&&(Ke(s.head),s.strstart=0,s.block_start=0,s.insert=0);let e=new Uint8Array(s.w_size);e.set(t.subarray(i-s.w_size,i),0),t=e,i=s.w_size}const r=e.avail_in,n=e.next_in,o=e.input;for(e.avail_in=i,e.next_in=0,e.input=t,Je(s);s.lookahead>=3;){let e=s.strstart,t=s.lookahead-2;do{s.ins_h=Ve(s,s.ins_h,s.window[e+3-1]),s.prev[e&s.w_mask]=s.head[s.ins_h],s.head[s.ins_h]=e,e++}while(--t);s.strstart=e,s.lookahead=2,Je(s)}return s.strstart+=s.lookahead,s.block_start=s.strstart,s.insert=s.lookahead,s.lookahead=0,s.match_length=s.prev_length=2,s.match_available=0,e.next_in=n,e.input=o,e.avail_in=r,s.wrap=a,Ee},deflateInfo:"pako deflate (from Nodeca project)"},ht=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),_t={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(const t in i)ht(i,t)&&(e[t]=i[t])}}return e},flattenChunks:e=>{let t=0;for(let i=0,s=e.length;i<s;i++)t+=e[i].length;const i=new Uint8Array(t);for(let t=0,s=0,a=e.length;t<a;t++){let a=e[t];i.set(a,s),s+=a.length}return i}},dt=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){dt=!1}var ct=new Uint8Array(256);for(let e=0;e<256;e++)ct[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;ct[254]=ct[254]=1;var ft={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,i,s,a,r,n=e.length,o=0;for(a=0;a<n;a++)i=e.charCodeAt(a),55296==(64512&i)&&a+1<n&&(s=e.charCodeAt(a+1),56320==(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),a++)),o+=i<128?1:i<2048?2:i<65536?3:4;for(t=new Uint8Array(o),r=0,a=0;r<o;a++)i=e.charCodeAt(a),55296==(64512&i)&&a+1<n&&(s=e.charCodeAt(a+1),56320==(64512&s)&&(i=65536+(i-55296<<10)+(s-56320),a++)),i<128?t[r++]=i:i<2048?(t[r++]=192|i>>>6,t[r++]=128|63&i):i<65536?(t[r++]=224|i>>>12,t[r++]=128|i>>>6&63,t[r++]=128|63&i):(t[r++]=240|i>>>18,t[r++]=128|i>>>12&63,t[r++]=128|i>>>6&63,t[r++]=128|63&i);return t},buf2string:(e,t)=>{const i=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let s,a;const r=new Array(2*i);for(a=0,s=0;s<i;){let t=e[s++];if(t<128){r[a++]=t;continue}let n=ct[t];if(n>4)r[a++]=65533,s+=n-1;else{for(t&=2===n?31:3===n?15:7;n>1&&s<i;)t=t<<6|63&e[s++],n--;n>1?r[a++]=65533:t<65536?r[a++]=t:(t-=65536,r[a++]=55296|t>>10&1023,r[a++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&dt)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let i="";for(let s=0;s<t;s++)i+=String.fromCharCode(e[s]);return i})(r,a)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let i=t-1;for(;i>=0&&128==(192&e[i]);)i--;return i<0||0===i?t:i+ct[e[i]]>t?i:t}};var ut=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0},gt=Object.prototype.toString,{Z_NO_FLUSH:pt,Z_SYNC_FLUSH:mt,Z_FULL_FLUSH:bt,Z_FINISH:wt,Z_OK:vt,Z_STREAM_END:kt,Z_DEFAULT_COMPRESSION:yt,Z_DEFAULT_STRATEGY:xt,Z_DEFLATED:zt}=ue;function Et(e){this.options=_t.assign({level:yt,method:zt,chunkSize:16384,windowBits:15,memLevel:8,strategy:xt},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ut,this.strm.avail_out=0;let i=lt.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==vt)throw new Error(fe[i]);if(t.header&&lt.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?ft.string2buf(t.dictionary):"[object ArrayBuffer]"===gt.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,i=lt.deflateSetDictionary(this.strm,e),i!==vt)throw new Error(fe[i]);this._dict_set=!0}}Et.prototype.push=function(e,t){const i=this.strm,s=this.options.chunkSize;let a,r;if(this.ended)return!1;for(r=t===~~t?t:!0===t?wt:pt,"string"==typeof e?i.input=ft.string2buf(e):"[object ArrayBuffer]"===gt.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),(r===mt||r===bt)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(a=lt.deflate(i,r),a===kt)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),a=lt.deflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===vt;if(0!==i.avail_out){if(r>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(0===i.avail_in)break}else this.onData(i.output)}return!0},Et.prototype.onData=function(e){this.chunks.push(e)},Et.prototype.onEnd=function(e){e===vt&&(this.result=_t.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var Bt=function(e,t){let i,s,a,r,n,o,l,h,_,d,c,f,u,g,p,m,b,w,v,k,y,x,z,E;const B=e.state;i=e.next_in,z=e.input,s=i+(e.avail_in-5),a=e.next_out,E=e.output,r=a-(t-e.avail_out),n=a+(e.avail_out-257),o=B.dmax,l=B.wsize,h=B.whave,_=B.wnext,d=B.window,c=B.hold,f=B.bits,u=B.lencode,g=B.distcode,p=(1<<B.lenbits)-1,m=(1<<B.distbits)-1;e:do{f<15&&(c+=z[i++]<<f,f+=8,c+=z[i++]<<f,f+=8),b=u[c&p];t:for(;;){if(w=b>>>24,c>>>=w,f-=w,w=b>>>16&255,0===w)E[a++]=65535&b;else{if(!(16&w)){if(0==(64&w)){b=u[(65535&b)+(c&(1<<w)-1)];continue t}if(32&w){B.mode=12;break e}e.msg="invalid literal/length code",B.mode=30;break e}v=65535&b,w&=15,w&&(f<w&&(c+=z[i++]<<f,f+=8),v+=c&(1<<w)-1,c>>>=w,f-=w),f<15&&(c+=z[i++]<<f,f+=8,c+=z[i++]<<f,f+=8),b=g[c&m];i:for(;;){if(w=b>>>24,c>>>=w,f-=w,w=b>>>16&255,!(16&w)){if(0==(64&w)){b=g[(65535&b)+(c&(1<<w)-1)];continue i}e.msg="invalid distance code",B.mode=30;break e}if(k=65535&b,w&=15,f<w&&(c+=z[i++]<<f,f+=8,f<w&&(c+=z[i++]<<f,f+=8)),k+=c&(1<<w)-1,k>o){e.msg="invalid distance too far back",B.mode=30;break e}if(c>>>=w,f-=w,w=a-r,k>w){if(w=k-w,w>h&&B.sane){e.msg="invalid distance too far back",B.mode=30;break e}if(y=0,x=d,0===_){if(y+=l-w,w<v){v-=w;do{E[a++]=d[y++]}while(--w);y=a-k,x=E}}else if(_<w){if(y+=l+_-w,w-=_,w<v){v-=w;do{E[a++]=d[y++]}while(--w);if(y=0,_<v){w=_,v-=w;do{E[a++]=d[y++]}while(--w);y=a-k,x=E}}}else if(y+=_-w,w<v){v-=w;do{E[a++]=d[y++]}while(--w);y=a-k,x=E}for(;v>2;)E[a++]=x[y++],E[a++]=x[y++],E[a++]=x[y++],v-=3;v&&(E[a++]=x[y++],v>1&&(E[a++]=x[y++]))}else{y=a-k;do{E[a++]=E[y++],E[a++]=E[y++],E[a++]=E[y++],v-=3}while(v>2);v&&(E[a++]=E[y++],v>1&&(E[a++]=E[y++]))}break}}break}}while(i<s&&a<n);v=f>>3,i-=v,f-=v<<3,c&=(1<<f)-1,e.next_in=i,e.next_out=a,e.avail_in=i<s?s-i+5:5-(i-s),e.avail_out=a<n?n-a+257:257-(a-n),B.hold=c,B.bits=f},St=15,At=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),It=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Rt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Mt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]),Nt=(e,t,i,s,a,r,n,o)=>{const l=o.bits;let h,_,d,c,f,u,g=0,p=0,m=0,b=0,w=0,v=0,k=0,y=0,x=0,z=0,E=null,B=0;const S=new Uint16Array(16),A=new Uint16Array(16);let I,R,M,N=null,U=0;for(g=0;g<=St;g++)S[g]=0;for(p=0;p<s;p++)S[t[i+p]]++;for(w=l,b=St;b>=1&&0===S[b];b--);if(w>b&&(w=b),0===b)return a[r++]=20971520,a[r++]=20971520,o.bits=1,0;for(m=1;m<b&&0===S[m];m++);for(w<m&&(w=m),y=1,g=1;g<=St;g++)if(y<<=1,y-=S[g],y<0)return-1;if(y>0&&(0===e||1!==b))return-1;for(A[1]=0,g=1;g<St;g++)A[g+1]=A[g]+S[g];for(p=0;p<s;p++)0!==t[i+p]&&(n[A[t[i+p]]++]=p);if(0===e?(E=N=n,u=19):1===e?(E=At,B-=257,N=It,U-=257,u=256):(E=Rt,N=Mt,u=-1),z=0,p=0,g=m,f=r,v=w,k=0,d=-1,x=1<<w,c=x-1,1===e&&x>852||2===e&&x>592)return 1;for(;;){I=g-k,n[p]<u?(R=0,M=n[p]):n[p]>u?(R=N[U+n[p]],M=E[B+n[p]]):(R=96,M=0),h=1<<g-k,_=1<<v,m=_;do{_-=h,a[f+(z>>k)+_]=I<<24|R<<16|M|0}while(0!==_);for(h=1<<g-1;z&h;)h>>=1;if(0!==h?(z&=h-1,z+=h):z=0,p++,0==--S[g]){if(g===b)break;g=t[i+n[p]]}if(g>w&&(z&c)!==d){for(0===k&&(k=w),f+=m,v=g-k,y=1<<v;v+k<b&&(y-=S[v+k],!(y<=0));)v++,y<<=1;if(x+=1<<v,1===e&&x>852||2===e&&x>592)return 1;d=z&c,a[d]=w<<24|v<<16|f-r|0}}return 0!==z&&(a[f+z]=g-k<<24|64<<16|0),o.bits=w,0},{Z_FINISH:Ut,Z_BLOCK:Dt,Z_TREES:Ct,Z_OK:Tt,Z_STREAM_END:Ft,Z_NEED_DICT:Lt,Z_STREAM_ERROR:jt,Z_DATA_ERROR:Ot,Z_MEM_ERROR:Ht,Z_BUF_ERROR:Qt,Z_DEFLATED:Zt}=ue,Pt=12,Kt=30,Vt=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Gt(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}var Wt,qt,Yt=e=>{if(!e||!e.state)return jt;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Tt},$t=e=>{if(!e||!e.state)return jt;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Yt(e)},Xt=(e,t)=>{let i;if(!e||!e.state)return jt;const s=e.state;return t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?jt:(null!==s.window&&s.wbits!==t&&(s.window=null),s.wrap=i,s.wbits=t,$t(e))},Jt=(e,t)=>{if(!e)return jt;const i=new Gt;e.state=i,i.window=null;const s=Xt(e,t);return s!==Tt&&(e.state=null),s},ei=!0,ti=e=>{if(ei){Wt=new Int32Array(512),qt=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Nt(1,e.lens,0,288,Wt,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Nt(2,e.lens,0,32,qt,0,e.work,{bits:5}),ei=!1}e.lencode=Wt,e.lenbits=9,e.distcode=qt,e.distbits=5},ii=(e,t,i,s)=>{let a;const r=e.state;return null===r.window&&(r.wsize=1<<r.wbits,r.wnext=0,r.whave=0,r.window=new Uint8Array(r.wsize)),s>=r.wsize?(r.window.set(t.subarray(i-r.wsize,i),0),r.wnext=0,r.whave=r.wsize):(a=r.wsize-r.wnext,a>s&&(a=s),r.window.set(t.subarray(i-s,i-s+a),r.wnext),(s-=a)?(r.window.set(t.subarray(i-s,i),0),r.wnext=s,r.whave=r.wsize):(r.wnext+=a,r.wnext===r.wsize&&(r.wnext=0),r.whave<r.wsize&&(r.whave+=a))),0},si={inflateReset:$t,inflateReset2:Xt,inflateResetKeep:Yt,inflateInit:e=>Jt(e,15),inflateInit2:Jt,inflate:(e,t)=>{let i,s,a,r,n,o,l,h,_,d,c,f,u,g,p,m,b,w,v,k,y,x,z=0;const E=new Uint8Array(4);let B,S;const A=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return jt;i=e.state,i.mode===Pt&&(i.mode=13),n=e.next_out,a=e.output,l=e.avail_out,r=e.next_in,s=e.input,o=e.avail_in,h=i.hold,_=i.bits,d=o,c=l,x=Tt;e:for(;;)switch(i.mode){case 1:if(0===i.wrap){i.mode=13;break}for(;_<16;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}if(2&i.wrap&&35615===h){i.check=0,E[0]=255&h,E[1]=h>>>8&255,i.check=ce(i.check,E,2,0),h=0,_=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&h)<<8)+(h>>8))%31){e.msg="incorrect header check",i.mode=Kt;break}if((15&h)!==Zt){e.msg="unknown compression method",i.mode=Kt;break}if(h>>>=4,_-=4,y=8+(15&h),0===i.wbits)i.wbits=y;else if(y>i.wbits){e.msg="invalid window size",i.mode=Kt;break}i.dmax=1<<i.wbits,e.adler=i.check=1,i.mode=512&h?10:Pt,h=0,_=0;break;case 2:for(;_<16;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}if(i.flags=h,(255&i.flags)!==Zt){e.msg="unknown compression method",i.mode=Kt;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=Kt;break}i.head&&(i.head.text=h>>8&1),512&i.flags&&(E[0]=255&h,E[1]=h>>>8&255,i.check=ce(i.check,E,2,0)),h=0,_=0,i.mode=3;case 3:for(;_<32;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}i.head&&(i.head.time=h),512&i.flags&&(E[0]=255&h,E[1]=h>>>8&255,E[2]=h>>>16&255,E[3]=h>>>24&255,i.check=ce(i.check,E,4,0)),h=0,_=0,i.mode=4;case 4:for(;_<16;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}i.head&&(i.head.xflags=255&h,i.head.os=h>>8),512&i.flags&&(E[0]=255&h,E[1]=h>>>8&255,i.check=ce(i.check,E,2,0)),h=0,_=0,i.mode=5;case 5:if(1024&i.flags){for(;_<16;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}i.length=h,i.head&&(i.head.extra_len=h),512&i.flags&&(E[0]=255&h,E[1]=h>>>8&255,i.check=ce(i.check,E,2,0)),h=0,_=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&(f=i.length,f>o&&(f=o),f&&(i.head&&(y=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(s.subarray(r,r+f),y)),512&i.flags&&(i.check=ce(i.check,s,f,r)),o-=f,r+=f,i.length-=f),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(0===o)break e;f=0;do{y=s[r+f++],i.head&&y&&i.length<65536&&(i.head.name+=String.fromCharCode(y))}while(y&&f<o);if(512&i.flags&&(i.check=ce(i.check,s,f,r)),o-=f,r+=f,y)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(0===o)break e;f=0;do{y=s[r+f++],i.head&&y&&i.length<65536&&(i.head.comment+=String.fromCharCode(y))}while(y&&f<o);if(512&i.flags&&(i.check=ce(i.check,s,f,r)),o-=f,r+=f,y)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;_<16;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}if(h!==(65535&i.check)){e.msg="header crc mismatch",i.mode=Kt;break}h=0,_=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=Pt;break;case 10:for(;_<32;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}e.adler=i.check=Vt(h),h=0,_=0,i.mode=11;case 11:if(0===i.havedict)return e.next_out=n,e.avail_out=l,e.next_in=r,e.avail_in=o,i.hold=h,i.bits=_,Lt;e.adler=i.check=1,i.mode=Pt;case Pt:if(t===Dt||t===Ct)break e;case 13:if(i.last){h>>>=7&_,_-=7&_,i.mode=27;break}for(;_<3;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}switch(i.last=1&h,h>>>=1,_-=1,3&h){case 0:i.mode=14;break;case 1:if(ti(i),i.mode=20,t===Ct){h>>>=2,_-=2;break e}break;case 2:i.mode=17;break;case 3:e.msg="invalid block type",i.mode=Kt}h>>>=2,_-=2;break;case 14:for(h>>>=7&_,_-=7&_;_<32;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}if((65535&h)!=(h>>>16^65535)){e.msg="invalid stored block lengths",i.mode=Kt;break}if(i.length=65535&h,h=0,_=0,i.mode=15,t===Ct)break e;case 15:i.mode=16;case 16:if(f=i.length,f){if(f>o&&(f=o),f>l&&(f=l),0===f)break e;a.set(s.subarray(r,r+f),n),o-=f,r+=f,l-=f,n+=f,i.length-=f;break}i.mode=Pt;break;case 17:for(;_<14;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}if(i.nlen=257+(31&h),h>>>=5,_-=5,i.ndist=1+(31&h),h>>>=5,_-=5,i.ncode=4+(15&h),h>>>=4,_-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=Kt;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;_<3;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}i.lens[A[i.have++]]=7&h,h>>>=3,_-=3}for(;i.have<19;)i.lens[A[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,B={bits:i.lenbits},x=Nt(0,i.lens,0,19,i.lencode,0,i.work,B),i.lenbits=B.bits,x){e.msg="invalid code lengths set",i.mode=Kt;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;z=i.lencode[h&(1<<i.lenbits)-1],p=z>>>24,m=z>>>16&255,b=65535&z,!(p<=_);){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}if(b<16)h>>>=p,_-=p,i.lens[i.have++]=b;else{if(16===b){for(S=p+2;_<S;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}if(h>>>=p,_-=p,0===i.have){e.msg="invalid bit length repeat",i.mode=Kt;break}y=i.lens[i.have-1],f=3+(3&h),h>>>=2,_-=2}else if(17===b){for(S=p+3;_<S;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}h>>>=p,_-=p,y=0,f=3+(7&h),h>>>=3,_-=3}else{for(S=p+7;_<S;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}h>>>=p,_-=p,y=0,f=11+(127&h),h>>>=7,_-=7}if(i.have+f>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=Kt;break}for(;f--;)i.lens[i.have++]=y}}if(i.mode===Kt)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=Kt;break}if(i.lenbits=9,B={bits:i.lenbits},x=Nt(1,i.lens,0,i.nlen,i.lencode,0,i.work,B),i.lenbits=B.bits,x){e.msg="invalid literal/lengths set",i.mode=Kt;break}if(i.distbits=6,i.distcode=i.distdyn,B={bits:i.distbits},x=Nt(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,B),i.distbits=B.bits,x){e.msg="invalid distances set",i.mode=Kt;break}if(i.mode=20,t===Ct)break e;case 20:i.mode=21;case 21:if(o>=6&&l>=258){e.next_out=n,e.avail_out=l,e.next_in=r,e.avail_in=o,i.hold=h,i.bits=_,Bt(e,c),n=e.next_out,a=e.output,l=e.avail_out,r=e.next_in,s=e.input,o=e.avail_in,h=i.hold,_=i.bits,i.mode===Pt&&(i.back=-1);break}for(i.back=0;z=i.lencode[h&(1<<i.lenbits)-1],p=z>>>24,m=z>>>16&255,b=65535&z,!(p<=_);){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}if(m&&0==(240&m)){for(w=p,v=m,k=b;z=i.lencode[k+((h&(1<<w+v)-1)>>w)],p=z>>>24,m=z>>>16&255,b=65535&z,!(w+p<=_);){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}h>>>=w,_-=w,i.back+=w}if(h>>>=p,_-=p,i.back+=p,i.length=b,0===m){i.mode=26;break}if(32&m){i.back=-1,i.mode=Pt;break}if(64&m){e.msg="invalid literal/length code",i.mode=Kt;break}i.extra=15&m,i.mode=22;case 22:if(i.extra){for(S=i.extra;_<S;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}i.length+=h&(1<<i.extra)-1,h>>>=i.extra,_-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;z=i.distcode[h&(1<<i.distbits)-1],p=z>>>24,m=z>>>16&255,b=65535&z,!(p<=_);){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}if(0==(240&m)){for(w=p,v=m,k=b;z=i.distcode[k+((h&(1<<w+v)-1)>>w)],p=z>>>24,m=z>>>16&255,b=65535&z,!(w+p<=_);){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}h>>>=w,_-=w,i.back+=w}if(h>>>=p,_-=p,i.back+=p,64&m){e.msg="invalid distance code",i.mode=Kt;break}i.offset=b,i.extra=15&m,i.mode=24;case 24:if(i.extra){for(S=i.extra;_<S;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}i.offset+=h&(1<<i.extra)-1,h>>>=i.extra,_-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=Kt;break}i.mode=25;case 25:if(0===l)break e;if(f=c-l,i.offset>f){if(f=i.offset-f,f>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=Kt;break}f>i.wnext?(f-=i.wnext,u=i.wsize-f):u=i.wnext-f,f>i.length&&(f=i.length),g=i.window}else g=a,u=n-i.offset,f=i.length;f>l&&(f=l),l-=f,i.length-=f;do{a[n++]=g[u++]}while(--f);0===i.length&&(i.mode=21);break;case 26:if(0===l)break e;a[n++]=i.length,l--,i.mode=21;break;case 27:if(i.wrap){for(;_<32;){if(0===o)break e;o--,h|=s[r++]<<_,_+=8}if(c-=l,e.total_out+=c,i.total+=c,c&&(e.adler=i.check=i.flags?ce(i.check,a,c,n-c):_e(i.check,a,c,n-c)),c=l,(i.flags?h:Vt(h))!==i.check){e.msg="incorrect data check",i.mode=Kt;break}h=0,_=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;_<32;){if(0===o)break e;o--,h+=s[r++]<<_,_+=8}if(h!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=Kt;break}h=0,_=0}i.mode=29;case 29:x=Ft;break e;case Kt:x=Ot;break e;case 31:return Ht;default:return jt}return e.next_out=n,e.avail_out=l,e.next_in=r,e.avail_in=o,i.hold=h,i.bits=_,(i.wsize||c!==e.avail_out&&i.mode<Kt&&(i.mode<27||t!==Ut))&&ii(e,e.output,e.next_out,c-e.avail_out),d-=e.avail_in,c-=e.avail_out,e.total_in+=d,e.total_out+=c,i.total+=c,i.wrap&&c&&(e.adler=i.check=i.flags?ce(i.check,a,c,e.next_out-c):_e(i.check,a,c,e.next_out-c)),e.data_type=i.bits+(i.last?64:0)+(i.mode===Pt?128:0)+(20===i.mode||15===i.mode?256:0),(0===d&&0===c||t===Ut)&&x===Tt&&(x=Qt),x},inflateEnd:e=>{if(!e||!e.state)return jt;let t=e.state;return t.window&&(t.window=null),e.state=null,Tt},inflateGetHeader:(e,t)=>{if(!e||!e.state)return jt;const i=e.state;return 0==(2&i.wrap)?jt:(i.head=t,t.done=!1,Tt)},inflateSetDictionary:(e,t)=>{const i=t.length;let s,a,r;return e&&e.state?(s=e.state,0!==s.wrap&&11!==s.mode?jt:11===s.mode&&(a=1,a=_e(a,t,i,0),a!==s.check)?Ot:(r=ii(e,t,i,i),r?(s.mode=31,Ht):(s.havedict=1,Tt))):jt},inflateInfo:"pako inflate (from Nodeca project)"};var ai=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1},ri=Object.prototype.toString,{Z_NO_FLUSH:ni,Z_FINISH:oi,Z_OK:li,Z_STREAM_END:hi,Z_NEED_DICT:_i,Z_STREAM_ERROR:di,Z_DATA_ERROR:ci,Z_MEM_ERROR:fi}=ue;function ui(e){this.options=_t.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new ut,this.strm.avail_out=0;let i=si.inflateInit2(this.strm,t.windowBits);if(i!==li)throw new Error(fe[i]);if(this.header=new ai,si.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=ft.string2buf(t.dictionary):"[object ArrayBuffer]"===ri.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=si.inflateSetDictionary(this.strm,t.dictionary),i!==li)))throw new Error(fe[i])}function gi(e,t){const i=new ui(t);if(i.push(e),i.err)throw i.msg||fe[i.err];return i.result}ui.prototype.push=function(e,t){const i=this.strm,s=this.options.chunkSize,a=this.options.dictionary;let r,n,o;if(this.ended)return!1;for(n=t===~~t?t:!0===t?oi:ni,"[object ArrayBuffer]"===ri.call(e)?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(0===i.avail_out&&(i.output=new Uint8Array(s),i.next_out=0,i.avail_out=s),r=si.inflate(i,n),r===_i&&a&&(r=si.inflateSetDictionary(i,a),r===li?r=si.inflate(i,n):r===ci&&(r=_i));i.avail_in>0&&r===hi&&i.state.wrap>0&&0!==e[i.next_in];)si.inflateReset(i),r=si.inflate(i,n);switch(r){case di:case ci:case _i:case fi:return this.onEnd(r),this.ended=!0,!1}if(o=i.avail_out,i.next_out&&(0===i.avail_out||r===hi))if("string"===this.options.to){let e=ft.utf8border(i.output,i.next_out),t=i.next_out-e,a=ft.buf2string(i.output,e);i.next_out=t,i.avail_out=s-t,t&&i.output.set(i.output.subarray(e,e+t),0),this.onData(a)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(r!==li||0!==o){if(r===hi)return r=si.inflateEnd(this.strm),this.onEnd(r),this.ended=!0,!0;if(0===i.avail_in)break}}return!0},ui.prototype.onData=function(e){this.chunks.push(e)},ui.prototype.onEnd=function(e){e===li&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=_t.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var pi={Inflate:ui,inflate:gi,inflateRaw:function(e,t){return(t=t||{}).raw=!0,gi(e,t)},ungzip:gi,constants:ue},{Inflate:mi,inflate:bi,inflateRaw:wi,ungzip:vi}=pi,ki=bi;var yi=new Map([[1,function(e,t){let i=new Uint8Array(e);return ki(i).buffer}],[2,function(e,t){let i=e.byteLength,s=new Uint8Array(i),a=Math.floor(i/t),r=new DataView(e);for(var n=0;n<t;n++)for(var o=0;o<a;o++)s[n+o*t]=r.getUint8(n*a+o);return s.buffer}],[3,function(e,t){return function(e){for(var t=e.byteLength%2!=0,i=e.byteLength-4,s=new DataView(e),a=0,r=0,n=0;n<i-1;n+=2){r=(r+(a=(a+s.getUint16(n,!0))%65535))%65535}if(t){r=(r+(a=(a+s.getUint8(i-1))%65535))%65535}var[o,l]=h.unpack_from(">HH",e,i);if(l%=65535,a!=(o%=65535)||r!=l)throw'ValueError("fletcher32 checksum invalid")'}(e),e.slice(0,-4)}]]),xi=class{constructor(e,t){this.fh=e,this.offset=t,this.depth=null}init(){this.all_nodes=new Map,this._read_root_node(),this._read_children()}_read_children(){let e=this.depth;for(;e>0;){for(var t of this.all_nodes.get(e))for(var i of t.get("addresses"))this._add_node(this._read_node(i,e-1));e--}}_read_root_node(){let e=this._read_node(this.offset,null);this._add_node(e),this.depth=e.get("node_level")}_add_node(e){let t=e.get("node_level");this.all_nodes.has(t)?this.all_nodes.get(t).push(e):this.all_nodes.set(t,[e])}_read_node(e,t){let i=this._read_node_header(e,t);return i.set("keys",[]),i.set("addresses",[]),i}_read_node_header(e){throw"NotImplementedError: must define _read_node_header in implementation class"}},zi=class extends xi{constructor(){super(...arguments),t(this,"B_LINK_NODE",new Map([["signature","4s"],["node_type","B"],["node_level","B"],["entries_used","H"],["left_sibling","Q"],["right_sibling","Q"]]))}_read_node_header(e,t){let i=s(this.B_LINK_NODE,this.fh,e);if(null!=t&&i.get("node_level")!=t)throw"node level does not match";return i}},Ei=class extends zi{constructor(e,i){super(e,i),t(this,"NODE_TYPE",0),this.init()}_read_node(e,t){let i=this._read_node_header(e,t);e+=r(this.B_LINK_NODE);let s=[],a=[],n=i.get("entries_used");for(var o=0;o<n;o++){let t=h.unpack_from("<Q",this.fh,e)[0];e+=8;let i=h.unpack_from("<Q",this.fh,e)[0];e+=8,s.push(t),a.push(i)}return s.push(h.unpack_from("<Q",this.fh,e)[0]),i.set("keys",s),i.set("addresses",a),i}symbol_table_addresses(){var e=[],t=this.all_nodes.get(0);for(var i of t)e=e.concat(i.get("addresses"));return e}},Bi=class extends zi{constructor(e,i,s){super(e,i),t(this,"NODE_TYPE",1),this.dims=s,this.init()}_read_node(e,t){let i=this._read_node_header(e,t);e+=r(this.B_LINK_NODE);var s=[],a=[];let n=i.get("entries_used");for(var o=0;o<n;o++){let[t,i]=h.unpack_from("<II",this.fh,e);e+=8;let r="<"+this.dims.toFixed()+"Q",n=h.calcsize(r),o=h.unpack_from(r,this.fh,e);e+=n;let l=h.unpack_from("<Q",this.fh,e)[0];e+=8,s.push(new Map([["chunk_size",t],["filter_mask",i],["chunk_offset",o]])),a.push(l)}return i.set("keys",s),i.set("addresses",a),i}construct_data_from_chunks(e,t,i,s){var a,r,n;if(i instanceof Array){i;let e=i[0];if("REFERENCE"==e){if(8!=i[1])throw"NotImplementedError('Unsupported Reference type')";i="<u8";a="getUint64",r=!1,n=8}else{if("VLEN_STRING"!=e&&"VLEN_SEQUENCE"!=e)throw"NotImplementedError('datatype not implemented')";a="getVLENStruct",r=!1,n=16}}else null,[a,r,n]=l(i);var o=t.reduce((function(e,t){return e*t}),1),h=e.reduce((function(e,t){return e*t}),1);let d=t.length;var c=1,f=(e.slice().map((function(e){let t=c;return c*=e,t})),c=1,t.slice().reverse().map((function(e){let t=c;return c*=e,t})).reverse()),u=new Array(o);let g=h*n;for(var p of this.all_nodes.get(0)){let i=p.get("keys"),o=p.get("addresses"),l=i.length;for(var m=0;m<l;m++){let l=i[m],c=o[m];var b;if(null==s)b=this.fh.slice(c,c+g);else{b=this.fh.slice(c,c+l.get("chunk_size"));let e=l.get("filter_mask");b=this._filter_chunk(b,e,s,n)}for(var w=l.get("chunk_offset").slice(),v=w.slice(),k=v.map((function(){return 0})),y=new _(b),x=0;x<h;x++){for(var z=d-1;z>=0&&k[z]>=e[z];z--)k[z]=0,v[z]=w[z],z>0&&(k[z-1]+=1,v[z-1]+=1);if(v.slice(0,-1).every((function(e,i){return e<t[i]}))){let e=x*n,t=y[a](e,!r,n);u[v.slice(0,-1).reduce((function(e,t,i){return t*f[i]+e}),0)]=t}k[d-1]+=1,v[d-1]+=1}}}return u}_filter_chunk(e,t,i,s){let a=i.length,r=e.slice();for(var n=a-1;n>=0;n--){if(t&1<<n)continue;let e=i[n],a=e.get("filter_id"),o=e.get("client_data");if(!yi.has(a))throw'NotImplementedError("Filter with id:'+a.toFixed()+' not supported")';r=yi.get(a)(r,s,o)}return r}},Si=class extends xi{constructor(e,i){super(e,i),t(this,"B_TREE_HEADER",new Map([["signature","4s"],["version","B"],["node_type","B"],["node_size","I"],["record_size","H"],["depth","H"],["split_percent","B"],["merge_percent","B"],["root_address","Q"],["root_nrecords","H"],["total_nrecords","Q"]])),t(this,"B_LINK_NODE",new Map([["signature","4s"],["version","B"],["node_type","B"]])),this.init()}_read_root_node(){let e=this._read_tree_header(this.offset);this.address_formats=this._calculate_address_formats(e),this.header=e,this.depth=e.get("depth");let t=[e.get("root_address"),e.get("root_nrecords"),e.get("total_nrecords")],i=this._read_node(t,this.depth);this._add_node(i)}_read_tree_header(e){return s(this.B_TREE_HEADER,this.fh,this.offset)}_calculate_address_formats(e){let t=e.get("node_size"),i=e.get("record_size"),s=0,a=0,r=new Map,n=e.get("depth");for(var o=0;o<=n;o++){let e,l,h,_="",d="",c="";if(0==o?(e=0,l=0,h=0):1==o?(e=8,_="<Q",l=this._required_bytes(s),d=this._int_format(l),h=0):(e=8,_="<Q",l=this._required_bytes(s),d=this._int_format(l),h=this._required_bytes(a),c=this._int_format(h)),r.set(o,[e,l,h,_,d,c]),o<n){let r=e+l+h;s=this._nrecords_max(t,i,r),a>0?a*=s:a=s}}return r}_nrecords_max(e,t,i){return Math.floor((e-10-i)/(t+i))}_required_bytes(e){return Math.ceil(d(e)/8)}_int_format(e){return["<B","<H","<I","<Q"][e-1]}_read_node(e,t){let[i,s,a]=e,n=this._read_node_header(i,t);i+=r(this.B_LINK_NODE);let o=this.header.get("record_size"),l=[];for(let e=0;e<s;e++){let e=this._parse_record(this.fh,i,o);i+=o,l.push(e)}let _=[],d=this.address_formats.get(t);if(0!=t){let[e,t,a,r,n,o]=d;for(let l=0;l<=s;l++){let s=h.unpack_from(r,this.fh,i)[0];i+=e;let l=h.unpack_from(n,this.fh,i)[0];i+=t;let d=l;a>0&&(d=h.unpack_from(o,this.fh,i)[0]),_.push([s,l,d])}}return n.set("keys",l),n.set("addresses",_),n}_read_node_header(e,t){let i=s(this.B_LINK_NODE,this.fh,e);return i.set("node_level",t),i}*iter_records(){for(let e of this.all_nodes.values())for(let t of e)for(let e of t.get("keys"))yield e}_parse_record(e){throw"NotImplementedError"}},Ai=class extends Si{constructor(){super(...arguments),t(this,"NODE_TYPE",5)}_parse_record(e,t,i){let s=h.unpack_from("<I",e,t)[0];return t+=4,new Map([["namehash",s],["heapid",e.slice(t,t+7)]])}},Ii=class extends Si{constructor(){super(...arguments),t(this,"NODE_TYPE",6)}_parse_record(e,t,i){let s=h.unpack_from("<Q",e,t)[0];return t+=8,new Map([["creationorder",s],["heapid",e.slice(t,t+7)]])}},Ri=class{constructor(e,t){let i=h.unpack_from("<B",e,t+8);var a;if(0==i)a=s(Fi,e,t),this._end_of_sblock=t+Li;else{if(2!=i&&3!=i)throw"unsupported superblock version: "+i.toFixed();a=s(ji,e,t),this._end_of_sblock=t+Oi}if(a.get("format_signature")!=Ci)throw"Incorrect file signature: "+a.get("format_signature");if(8!=a.get("offset_size")||8!=a.get("length_size"))throw"File uses non-64-bit addressing";this.version=a.get("superblock_version"),this._contents=a,this._root_symbol_table=null,this._fh=e}get offset_to_dataobjects(){if(0==this.version){var e=new Ni(this._fh,this._end_of_sblock,!0);return this._root_symbol_table=e,e.group_offset}if(2==this.version||3==this.version)return this._contents.get("root_group_address");throw"Not implemented version = "+this.version.toFixed()}},Mi=class{constructor(e,t){let i=s(Ki,e,t);a("HEAP"==i.get("signature")),a(0==i.get("version"));let r=i.get("address_of_data_segment"),n=e.slice(r,r+i.get("data_segment_size"));i.set("heap_data",n),this._contents=i,this.data=n}get_object_name(e){let t=new Uint8Array(this.data).indexOf(0,e)-e;return h.unpack_from("<"+t.toFixed()+"s",this.data,e)[0]}},Ni=class{constructor(e,t,i=!1){var a;if(i)a=new Map([["symbols",1]]);else{if("SNOD"!=(a=s(Zi,e,t)).get("signature"))throw"incorrect node type";t+=Pi}for(var r=[],n=a.get("symbols"),o=0;o<n;o++)r.push(s(Hi,e,t)),t+=Qi;i&&(this.group_offset=r[0].get("object_header_address")),this.entries=r,this._contents=a}assign_name(e){this.entries.forEach((function(t){let i=t.get("link_name_offset"),s=e.get_object_name(i);t.set("link_name",s)}))}get_links(e){var t={};return this.entries.forEach((function(i){let s=i.get("cache_type"),a=i.get("link_name");if(0==s||1==s)t[a]=i.get("object_header_address");else if(2==s){let s=i.get("scratch"),n=new ArrayBuffer(4),o=new Uint8Array(n);for(var r=0;r<4;r++)o[r]=s.charCodeAt(r);let l=h.unpack_from("<I",n,0)[0];t[a]=e.get_object_name(l)}})),t}},Ui=class{constructor(e,t){let i=s(Vi,e,t);t+=Gi;let a=i.get("collection_size")-Gi,r=e.slice(t,t+a);this.heap_data=r,this._header=i,this._objects=null}get objects(){if(null==this._objects){this._objects=new Map;for(var e=0;e<=this.heap_data.byteLength-qi;){let t=s(Wi,this.heap_data,e);if(0==t.get("object_index"))break;e+=qi;let i=this.heap_data.slice(e,e+t.get("object_size"));this._objects.set(t.get("object_index"),i),e+=n(t.get("object_size"))}}return this._objects}},Di=class{constructor(e,t){this.fh=e;let i=s(Yi,e,t);if(t+=r(Yi),a("FRHP"==i.get("signature")),a(0==i.get("version")),i.get("filter_info_size")>0)throw"Filter info size not supported on FractalHeap";if(i.get("btree_address_huge_objects")!=Ti)throw"Huge objects not implemented in FractalHeap";i.set("btree_address_huge_objects",null),i.get("root_block_address")==Ti&&i.set("root_block_address",null);let n=i.get("log2_maximum_heap_size"),o=this._min_size_nbits(n),l=new Map([["signature","4s"],["version","B"],["heap_header_adddress","Q"],["block_offset",`${o}B`]]);this.indirect_block_header=new Map(l),this.indirect_block_header_size=r(l),2==(2&i.get("flags"))&&l.set("checksum","I"),this.direct_block_header=l,this.direct_block_header_size=r(l);let h=i.get("maximum_direct_block_size");this._managed_object_offset_size=this._min_size_nbits(n);let _=Math.min(h,i.get("max_managed_object_size"));this._managed_object_length_size=this._min_size_integer(_);let d=i.get("starting_block_size"),c=i.get("table_width");if(!(d>0))throw"Starting block size == 0 not implemented";let f=Number(Math.floor(Math.log2(h)));a(1n<<BigInt(f)==h);let u=Number(Math.floor(Math.log2(d)));a(1n<<BigInt(u)==d),this._max_direct_nrows=f-u+2;let g=Math.floor(Math.log2(c));a(1<<g==c),this._indirect_nrows_sub=g+u-1,this.header=i,this.nobjects=i.get("managed_object_count")+i.get("huge_object_count")+i.get("tiny_object_count");let p=[],m=i.get("root_block_address"),b=0;if(null!=m&&(b=i.get("indirect_current_rows_count")),b>0)for(let t of this._iter_indirect_block(e,m,b))p.push(t);else{let t=this._read_direct_block(e,m,d);p.push(t)}let w=p.reduce(((e,t)=>e+t.byteLength),0),v=new Uint8Array(w),k=0;p.forEach((e=>{v.set(new Uint8Array(e),k),k+=e.byteLength})),this.managed=v.buffer}_read_direct_block(e,t,i){let r=e.slice(t,t+i);return a("FHDB"==s(this.direct_block_header,r).get("signature")),r}get_data(e){let t=h.unpack_from("<B",e,0)[0],i=t>>4&3,s=1;if(0==i){a(0==t>>6);let i=this._managed_object_offset_size,r=c(i,e,s);s+=i,i=this._managed_object_length_size;let n=c(i,e,s);return this.managed.slice(r,r+n)}throw 1==i?"tiny objectID not supported in FractalHeap":2==i?"huge objectID not supported in FractalHeap":"unknown objectID type in FractalHeap"}_min_size_integer(e){return this._min_size_nbits(d(e))}_min_size_nbits(e){return Math.ceil(e/8)}*_iter_indirect_block(e,t,i){let r=s(this.indirect_block_header,e,t);t+=this.indirect_block_header_size,a("FHIB"==r.get("signature"));let n=r.get("block_offset").reduce(((e,t,i)=>e+(t<<8*i)),0);r.set("block_offset",n);let[o,l]=this._indirect_info(i),_=[];for(let i=0;i<o;i++){let s=h.unpack_from("<Q",e,t)[0];if(t+=8,s==Ti)break;let a=this._calc_block_size(i);_.push([s,a])}let d=[];for(let i=o;i<o+l;i++){let s=h.unpack_from("<Q",e,t)[0];if(t+=8,s==Ti)break;let a=this._calc_block_size(i),r=this._iblock_nrows_from_block_size(a);d.push([s,r])}for(let[t,i]of _){let s=this._read_direct_block(e,t,i);yield s}for(let[t,i]of d)for(let s of this._iter_indirect_block(e,t,i))yield s}_calc_block_size(e){let t=Math.floor(e/this.header.get("table_width"));return 2**Math.max(t-1,0)*this.header.get("starting_block_size")}_iblock_nrows_from_block_size(e){let t=Math.floor(Math.log2(e));return a(2**t==e),t-this._indirect_nrows_sub}_indirect_info(e){let t,i,s=this.header.get("table_width"),a=e*s,r=this._max_direct_nrows*s;return e<=r?(t=a,i=0):(t=r,i=a-r),[t,i]}_int_format(e){return["B","H","I","Q"][e-1]}},Ci=h.unpack_from("8s",new Uint8Array([137,72,68,70,13,10,26,10]).buffer)[0],Ti=h.unpack_from("<Q",new Uint8Array([255,255,255,255,255,255,255,255]).buffer)[0],Fi=new Map([["format_signature","8s"],["superblock_version","B"],["free_storage_version","B"],["root_group_version","B"],["reserved_0","B"],["shared_header_version","B"],["offset_size","B"],["length_size","B"],["reserved_1","B"],["group_leaf_node_k","H"],["group_internal_node_k","H"],["file_consistency_flags","L"],["base_address_lower","Q"],["free_space_address","Q"],["end_of_file_address","Q"],["driver_information_address","Q"]]),Li=r(Fi),ji=new Map([["format_signature","8s"],["superblock_version","B"],["offset_size","B"],["length_size","B"],["file_consistency_flags","B"],["base_address","Q"],["superblock_extension_address","Q"],["end_of_file_address","Q"],["root_group_address","Q"],["superblock_checksum","I"]]),Oi=r(ji),Hi=new Map([["link_name_offset","Q"],["object_header_address","Q"],["cache_type","I"],["reserved","I"],["scratch","16s"]]),Qi=r(Hi),Zi=new Map([["signature","4s"],["version","B"],["reserved_0","B"],["symbols","H"]]),Pi=r(Zi),Ki=new Map([["signature","4s"],["version","B"],["reserved","3s"],["data_segment_size","Q"],["offset_to_free_list","Q"],["address_of_data_segment","Q"]]),Vi=new Map([["signature","4s"],["version","B"],["reserved","3s"],["collection_size","Q"]]),Gi=r(Vi),Wi=new Map([["object_index","H"],["reference_count","H"],["reserved","I"],["object_size","Q"]]),qi=r(Wi),Yi=new Map([["signature","4s"],["version","B"],["object_index_size","H"],["filter_info_size","H"],["flags","B"],["max_managed_object_size","I"],["next_huge_object_index","Q"],["btree_address_huge_objects","Q"],["managed_freespace_size","Q"],["freespace_manager_address","Q"],["managed_space_size","Q"],["managed_alloc_size","Q"],["next_directblock_iterator_address","Q"],["managed_object_count","Q"],["huge_objects_total_size","Q"],["huge_object_count","Q"],["tiny_objects_total_size","Q"],["tiny_object_count","Q"],["table_width","H"],["starting_block_size","Q"],["maximum_direct_block_size","Q"],["log2_maximum_heap_size","H"],["indirect_starting_rows_count","H"],["root_block_address","Q"],["indirect_current_rows_count","H"]]),$i=class{constructor(e,t){let i=h.unpack_from("<B",e,t)[0];if(1==i)var[s,a,r]=this._parse_v1_objects(e,t);else{if(i!="O".charCodeAt(0))throw"InvalidHDF5File('unknown Data Object Header')";var[s,a,r]=this._parse_v2_objects(e,t)}this.fh=e,this.msgs=s,this.msg_data=a,this.offset=t,this._global_heaps={},this._header=r,this._filter_pipeline=null,this._chunk_params_set=!1,this._chunks=null,this._chunk_dims=null,this._chunk_address=null}get dtype(){let e=this.find_msg_type(Es)[0].get("offset_to_message");return new f(this.fh,e).dtype}get chunks(){return this._get_chunk_params(),this._chunks}get shape(){let e=this.find_msg_type(xs)[0].get("offset_to_message");return function(e,t){let i=h.unpack_from("<B",e,t)[0];var r;if(1==i)a(1==(r=s(ns,e,t)).get("version")),t+=os;else{if(2!=i)throw"InvalidHDF5File('unknown dataspace message version')";a(2==(r=s(ls,e,t)).get("version")),t+=hs}let n=r.get("dimensionality");return h.unpack_from("<"+(2*n).toFixed()+"I",e,t).filter((function(e,t){return t%2==0}))}(this.fh,e)}get filter_pipeline(){if(null!=this._filter_pipeline)return this._filter_pipeline;let e=this.find_msg_type(Is);if(!e.length)return this._filter_pipeline=null,this._filter_pipeline;var t=e[0].get("offset_to_message");let[i,a]=h.unpack_from("<BB",this.fh,t);t+=h.calcsize("<BB");var r=[];if(1==i){let[e,i]=h.unpack_from("<HI",this.fh,t);t+=h.calcsize("<HI");for(var o=0;o<a;o++){let e=s(ks,this.fh,t);t+=ys;let i=n(e.get("name_length"),8),a="<"+i.toFixed()+"s",o=h.unpack_from(a,this.fh,t)[0];e.set("filter_name",o),t+=i,a="<"+e.get("client_data_values").toFixed()+"I";let l=h.unpack_from(a,this.fh,t);e.set("client_data",l),t+=4*e.get("client_data_values"),e.get("client_data_values")%2&&(t+=4),r.push(e)}}else{if(2!=i)throw`version ${i} is not supported`;for(let e=0;e<a;e++){let e=new Map,i=this.fh,s=h.unpack_from("<H",i,t)[0];t+=2,e.set("filter_id",s);let a=0;s>255&&(a=h.unpack_from("<H",i,t)[0],t+=2);let n=h.unpack_from("<H",i,t)[0];t+=2;let o=(1&n)>0;e.set("optional",o);let l,_=h.unpack_from("<H",i,t)[0];t+=2,a>0&&(l=h.unpack_from(`${a}s`,i,t)[0],t+=a),e.set("name",l);let d=h.unpack_from(`<${_}i`,i,t);t+=4*_,e.set("client_data_values",d),r.push(e)}}return this._filter_pipeline=r,this._filter_pipeline}find_msg_type(e){return this.msgs.filter((function(t){return t.get("type")==e}))}get_attributes(){let e={},t=this.find_msg_type(Rs);for(let i of t){let t=i.get("offset_to_message"),[s,a]=this.unpack_attribute(t);e[s]=a}return e}get fillvalue(){var e,t=this.find_msg_type(Bs)[0].get("offset_to_message");let i=h.unpack_from("<B",this.fh,t)[0];var a,r,n;if(1==i||2==i)a=s(ms,this.fh,t),t+=bs,e=a.get("fillvalue_defined");else{if(3!=i)throw'InvalidHDF5File("Unknown fillvalue msg version: "'+String(i);a=s(ws,this.fh,t),t+=vs,e=32&a.get("flags")}if(e?(r=h.unpack_from("<I",this.fh,t)[0],t+=4):r=0,r){let[e,i,s]=l(this.dtype);n=new _(this.fh)[e](t,!i,s)}else n=0;return n}unpack_attribute(e){let t=h.unpack_from("<B",this.fh,e)[0];var i,r;if(1==t)a(1==(i=s(es,this.fh,e)).get("version")),e+=ts,r=8;else{if(3!=t)throw"unsupported attribute message version: "+t;a(3==(i=s(is,this.fh,e)).get("version")),e+=ss,r=1}let o=i.get("name_size"),l=h.unpack_from("<"+o.toFixed()+"s",this.fh,e)[0];var _;l=l.replace(/\x00$/,""),e+=n(o,r);try{_=new f(this.fh,e).dtype}catch(e){return console.log("Attribute "+l+" type not implemented, set to null."),[l,null]}e+=n(i.get("datatype_size"),r);let d=this.determine_data_shape(this.fh,e),c=d.reduce((function(e,t){return e*t}),1);e+=n(i.get("dataspace_size"),r);var u=this._attr_value(_,this.fh,c,e);return 0==d.length&&(u=u[0]),[l,u]}determine_data_shape(e,t){let i=h.unpack_from("<B",e,t)[0];var r;if(1==i)a(1==(r=s(ns,e,t)).get("version")),t+=os;else{if(2!=i)throw"unknown dataspace message version";a(2==(r=s(ls,e,t)).get("version")),t+=hs}let n=r.get("dimensionality");return h.unpack_from("<"+n.toFixed()+"Q",e,t)}_attr_value(e,t,i,s){var a=new Array(i);if(e instanceof Array){let l=e[0];for(var r=0;r<i;r++)if("VLEN_STRING"==l){let i=e[2];var[n,o]=this._vlen_size_and_data(t,s);const l=new TextDecoder(0==i?"ascii":"utf-8");a[r]=l.decode(o),s+=16}else if("REFERENCE"==l){var d=h.unpack_from("<Q",t,s);a[r]=d,s+=8}else{if("VLEN_SEQUENCE"!=l)throw"NotImplementedError";{let i=e[1];var[n,o]=this._vlen_size_and_data(t,s);a[r]=this._attr_value(i,o,n,0),s+=16}}}else{let[n,o,h]=l(e),d=new _(t,0);for(r=0;r<i;r++)a[r]=d[n](s,!o,h),s+=h}return a}_vlen_size_and_data(e,t){let i=h.unpack_from("<I",e,t)[0],r=s(Ji,e,t+4),n=r.get("collection_address");var o;return a(r.get("collection_address")<Number.MAX_SAFE_INTEGER),n in this._global_heaps||(o=new Ui(this.fh,n),this._global_heaps[n]=o),[i,(o=this._global_heaps[n]).objects.get(r.get("object_index"))]}_parse_v1_objects(e,t){let i=s(as,e,t);a(1==i.get("version"));let n=i.get("total_header_messages");for(var o=i.get("object_header_size"),l=t+r(as),_=e.slice(l,l+o),d=[[l,o]],c=0,f=0,u=new Array(n),g=0;g<n;g++){f>=o&&([l,o]=d[++c],f=0);let t=s(_s,e,l+f),i=l+f+ds;if(t.set("offset_to_message",i),t.get("type")==Ms){var[p,m]=h.unpack_from("<QQ",e,i);d.push([p,m])}f+=ds+t.get("size"),u[g]=t}return[u,_,i]}_parse_v2_objects(e,t){var[i,a,r]=this._parse_v2_header(e,t);t=r;for(var n=[],o=i.get("size_of_chunk_0"),l=e.slice(t,t+=o),_=[[r,o]],d=0,c=0;;){if(c>=o-fs){let e=_[++d];if(null==e)break;[r,o]=e,c=0}let t=s(cs,e,r+c),i=r+c+fs+a;if(t.set("offset_to_message",i),t.get("type")==Ms){var[f,u]=h.unpack_from("<QQ",e,i);_.push([f+4,u-4])}c+=fs+t.get("size")+a,n.push(t)}return[n,l,i]}_parse_v2_header(e,t){let i=s(rs,e,t);var n;if(t+=r(rs),a(2==i.get("version")),n=4&i.get("flags")?2:0,a(0==(16&i.get("flags"))),32&i.get("flags")){let s=h.unpack_from("<4I",e,t);t+=16,i.set("access_time",s[0]),i.set("modification_time",s[1]),i.set("change_time",s[2]),i.set("birth_time",s[3])}let o=["<B","<H","<I","<Q"][3&i.get("flags")];return i.set("size_of_chunk_0",h.unpack_from(o,e,t)[0]),[i,n,t+=h.calcsize(o)]}get_links(){return Object.fromEntries(this.iter_links())}*iter_links(){for(let e of this.msgs)e.get("type")==Ns?yield*this._iter_links_from_symbol_tables(e):e.get("type")==Ss?yield this._get_link_from_link_msg(e):e.get("type")==zs&&(yield*this._iter_link_from_link_info_msg(e))}*_iter_links_from_symbol_tables(e){a(16==e.get("size"));let t=s(us,this.fh,e.get("offset_to_message"));yield*this._iter_links_btree_v1(t.get("btree_address"),t.get("heap_address"))}*_iter_links_btree_v1(e,t){let i=new Ei(this.fh,e),s=new Mi(this.fh,t);for(let e of i.symbol_table_addresses()){let t=new Ni(this.fh,e);t.assign_name(s),yield*Object.entries(t.get_links(s))}}_get_link_from_link_msg(e){let t=e.get("offset_to_message");return this._decode_link_msg(this.fh,t)[1]}_decode_link_msg(e,t){let[i,s]=h.unpack_from("<BB",e,t);t+=2,a(1==i);let r,n,o=2**(3&s),l=(16&s)>0,_=(4&s)>0;(8&s)>0?(r=h.unpack_from("<B",e,t)[0],t+=1):r=0,a([0,1].includes(r)),_&&(n=h.unpack_from("<Q",e,t)[0],t+=8);let d=0;l&&(d=h.unpack_from("<B",e,t)[0],t+=1);let c=0==d?"ascii":"utf-8",f=["<B","<H","<I","<Q"][3&s],u=h.unpack_from(f,e,t)[0];t+=o;let g,p=new TextDecoder(c).decode(e.slice(t,t+u));if(t+=u,0==r)g=h.unpack_from("<Q",e,t)[0];else if(1==r){let i=h.unpack_from("<H",e,t)[0];t+=2,g=new TextDecoder(c).decode(e.slice(t,t+i))}return[n,[p,g]]}*_iter_link_from_link_info_msg(e){let t=e.get("offset_to_message"),i=this._decode_link_info_msg(this.fh,t),s=i.get("heap_address"),a=i.get("name_btree_address"),r=i.get("order_btree_address");null!=a&&(yield*this._iter_links_btree_v2(a,r,s))}*_iter_links_btree_v2(e,t,i){let s,a=new Di(this.fh,i);s=t!=Xi?new Ii(this.fh,t):new Ai(this.fh,e);let r=new Map;for(let e of s.iter_records()){let t=a.get_data(e.get("heapid")),[i,s]=this._decode_link_msg(t,0);r.set(i,s)}let n=Array.from(r.keys()).sort();for(let e of n)yield r.get(e)}_decode_link_info_msg(e,t){let[i,r]=h.unpack_from("<BB",e,t);a(0==i),t+=2,(1&r)>0&&(t+=8);let n=s((2&r)>0?ps:gs,e,t),o=new Map;for(let[e,t]of n.entries())o.set(e,t==Xi?null:t);return o}get is_dataset(){return this.find_msg_type(xs).length>0}get_data(){let e=this.find_msg_type(As)[0].get("offset_to_message");var[t,i,s,a]=this._get_data_message_properties(e);if(0==s)throw"Compact storage of DataObject not implemented";return 1==s?this._get_contiguous_data(a):2==s?this._get_chunked_data(e):void 0}_get_data_message_properties(e){let t,i,s,[r,n,o]=h.unpack_from("<BBB",this.fh,e);return 1==r||2==r?(t=n,i=o,s=e,s+=h.calcsize("<BBB"),s+=h.calcsize("<BI"),a(1==i||2==i)):3!=r&&4!=r||(i=n,s=e,s+=h.calcsize("<BB")),a(r>=1&&r<=4),[r,t,i,s]}_get_contiguous_data(e){let[t]=h.unpack_from("<Q",this.fh,e);if(t==Xi){let e=this.shape.reduce((function(e,t){return e*t}),1);return new Array(e)}var i=this.shape.reduce((function(e,t){return e*t}),1);if(this.dtype instanceof Array){let e=this.dtype[0];if("REFERENCE"==e){if(8!=this.dtype[1])throw"NotImplementedError('Unsupported Reference type')";return this.fh.slice(t,t+i)}if("VLEN_STRING"==e){let e=this.dtype[2];const r=new TextDecoder(0==e?"ascii":"utf-8");var s=[];for(a=0;a<i;a++){const[e,i]=this._vlen_size_and_data(this.fh,t);s[a]=r.decode(i),t+=16}return s}throw"NotImplementedError('datatype not implemented')"}{let e=this.dtype;if(/[<>=!@\|]?(i|u|f|S)(\d*)/.test(e)){let[s,r,n]=l(e),o=new Array(i),h=new _(this.fh);for(var a=0;a<i;a++)o[a]=h[s](t+a*n,!r,n);return o}throw"not Implemented - no proper dtype defined"}}_get_chunked_data(e){this._get_chunk_params();let t=new Bi(this.fh,this._chunk_address,this._chunk_dims).construct_data_from_chunks(this.chunks,this.shape,this.dtype,this.filter_pipeline);if(this.dtype instanceof Array&&/^VLEN/.test(this.dtype[0])){let e=this.dtype[0];for(var i=0;i<t.length;i++){let[a,r,n]=t[i];var s;r in this._global_heaps?s=this._global_heaps[r]:(s=new Ui(this.fh,r),this._global_heaps[r]=s);let o=s.objects.get(n);if("VLEN_STRING"==e){let e=this.dtype[2];const s=new TextDecoder(0==e?"ascii":"utf-8");t[i]=s.decode(o)}}}return t}_get_chunk_params(){if(!this._chunk_params_set){this._chunk_params_set=!0;var e=this.find_msg_type(As)[0].get("offset_to_message"),[t,i,s,r]=this._get_data_message_properties(e);if(2==s){var n;if(1==t||2==t){var o=h.unpack_from("<Q",this.fh,r)[0];n=r+h.calcsize("<Q")}else if(3==t){var[i,o]=h.unpack_from("<BQ",this.fh,r);n=r+h.calcsize("<BQ")}a(t>=1&&t<=3);var l="<"+(i-1).toFixed()+"I",_=h.unpack_from(l,this.fh,n);this._chunks=_,this._chunk_dims=i,this._chunk_address=o}}}};var Xi=h.unpack_from("<Q",new Uint8Array([255,255,255,255,255,255,255,255]).buffer),Ji=new Map([["collection_address","Q"],["object_index","I"]]),es=(r(Ji),new Map([["version","B"],["reserved","B"],["name_size","H"],["datatype_size","H"],["dataspace_size","H"]])),ts=r(es),is=new Map([["version","B"],["flags","B"],["name_size","H"],["datatype_size","H"],["dataspace_size","H"],["character_set_encoding","B"]]),ss=r(is),as=new Map([["version","B"],["reserved","B"],["total_header_messages","H"],["object_reference_count","I"],["object_header_size","I"],["padding","I"]]),rs=new Map([["signature","4s"],["version","B"],["flags","B"]]),ns=new Map([["version","B"],["dimensionality","B"],["flags","B"],["reserved_0","B"],["reserved_1","I"]]),os=r(ns),ls=new Map([["version","B"],["dimensionality","B"],["flags","B"],["type","B"]]),hs=r(ls),_s=new Map([["type","H"],["size","H"],["flags","B"],["reserved","3s"]]),ds=r(_s),cs=new Map([["type","B"],["size","H"],["flags","B"]]),fs=r(cs),us=new Map([["btree_address","Q"],["heap_address","Q"]]),gs=new Map([["heap_address","Q"],["name_btree_address","Q"]]),ps=new Map([["heap_address","Q"],["name_btree_address","Q"],["order_btree_address","Q"]]),ms=new Map([["version","B"],["space_allocation_time","B"],["fillvalue_write_time","B"],["fillvalue_defined","B"]]),bs=r(ms),ws=new Map([["version","B"],["flags","B"]]),vs=r(ws),ks=new Map([["filter_id","H"],["name_length","H"],["flags","H"],["client_data_values","H"]]),ys=r(ks),xs=1,zs=2,Es=3,Bs=5,Ss=6,As=8,Is=11,Rs=12,Ms=16,Ns=17,Us=class{constructor(e,t,i,s=!1){if(null==i?(this.parent=this,this.file=this):(this.parent=i,this.file=i.file),this.name=e,this._links=t.get_links(),this._dataobjects=t,this._attrs=null,this._keys=null,s)return new Proxy(this,Ds)}get keys(){return null==this._keys&&(this._keys=Object.keys(this._links)),this._keys.slice()}get values(){return this.keys.map((e=>this.get(e)))}length(){return this.keys.length}_dereference(e){if(!e)throw"cannot deference null reference";let t=this.file._get_object_by_address(e);if(null==t)throw"reference not found in file";return t}get(e){if("number"==typeof e)return this._dereference(e);var t=Fs(e);if("/"==t)return this.file;if("."==t)return this;if(/^\//.test(t))return this.file.get(t.slice(1));if(""!=function(e){let t="/",i=e.lastIndexOf(t)+1,s=e.slice(0,i),a=new RegExp("^"+t+"+$"),r=new RegExp(t+"$");s&&!a.test(s)&&(s=s.replace(r,""));return s}(t))var[i,s]=t.split(/\/(.*)/);else var i=t,s=".";if(!(i in this._links))throw i+" not found in group";var a=Fs(this.name+"/"+i);let r=this._links[i];if("string"==typeof r)try{return this.get(r)}catch(e){return null}var n=new $i(this.file._fh,r);if(n.is_dataset){if("."!=s)throw a+" is a dataset, not a group";return new Ts(a,n,this)}return new Us(a,n,this).get(s)}visit(e){return this.visititems(((t,i)=>e(t)))}visititems(e){var t=this.name.length;/\/$/.test(this.name)||(t+=1);for(var i=this.values.slice();i;){let s=i.shift();1==i.length&&console.log(s);let a=e(s.name.slice(t),s);if(null!=a)return a;s instanceof Us&&(i=i.concat(s.values))}return null}get attrs(){return null==this._attrs&&(this._attrs=this._dataobjects.get_attributes()),this._attrs}},Ds={get:function(e,t,i){return t in e?e[t]:e.get(t)}},Cs=class extends Us{constructor(e,t){var i=new Ri(e,0).offset_to_dataobjects;super("/",new $i(e,i),null),this.parent=this,this._fh=e,this.filename=t||"",this.file=this,this.mode="r",this.userblock_size=0}_get_object_by_address(e){return this._dataobjects.offset==e?this:this.visititems((e=>{e._dataobjects.offset}))}},Ts=class extends Array{constructor(e,t,i){super(),this.parent=i,this.file=i.file,this.name=e,this._dataobjects=t,this._attrs=null,this._astype=null}get value(){var e=this._dataobjects.get_data();return null==this._astype?e:e.astype(this._astype)}get shape(){return this._dataobjects.shape}get attrs(){return this._dataobjects.get_attributes()}get dtype(){return this._dataobjects.dtype}get fillvalue(){return this._dataobjects.fillvalue}};function Fs(e){return e.replace(/\/(\/)+/g,"/")}return i})();function timeOffsetToDate(e,t){let i=60*e*60*1e3,s=Date.parse(t);return new Date(s+i)}async function drawImageData(e,t,i,s,a,r){const n=await createImageBitmap(t);e.drawImage(n,i,s,a,r)}function scaleUint8ClampedArrayPixelated(e,t,i,s,a){s=Math.ceil(s),a=Math.ceil(a);const r=new Uint8ClampedArray(s*a*4);jNorm=i/a,iNorm=t/s;for(let i=0;i<a;i++)for(let a=0;a<s;a++)oldIdx=Math.floor(i*jNorm)*t+Math.floor(a*iNorm),newIdx=i*s+a,r[4*newIdx+0]=e[4*oldIdx+0],r[4*newIdx+1]=e[4*oldIdx+1],r[4*newIdx+2]=e[4*oldIdx+2],r[4*newIdx+3]=e[4*oldIdx+3];return r}async function drawImageWithColourMap(e,t,i,s,a,r,n,o){const l=new Uint8ClampedArray(4*t.values.length);let h;for(let e=0;e<t.values.length;e++)if(isNaN(t.values[e]))l[4*e+0]=255,l[4*e+1]=255,l[4*e+2]=255,l[4*e+3]=0;else{let i=t.values[e]/o;for(h=0;h<n.values.length&&!(i<n.values[h]);h++);h-=1,h=Math.max(h,0),h=Math.min(h,n.r.length-1),l[4*e+0]=n.r[h],l[4*e+1]=n.g[h],l[4*e+2]=n.b[h],l[4*e+3]=255}a=Math.ceil(a),r=Math.ceil(r),arrBig=scaleUint8ClampedArrayPixelated(l,t.shape[1],t.shape[0],a,r);let _=new ImageData(arrBig,a,r);await drawImageData(e,_,i,s,a,r)}class colourBarSpecification{constructor(){this.showColourBar=!1,this.normalisation=1,this.barThickness=15,this.sizeFraction=.8,this.boundingBoxColour="#b3b3b3",this.boundingBoxLineWidth=1,this.plotGap=10,this.labelGap=4,this.label="",this.labelFontSize=10,this.labelFont="Arial",this.labelColour="black",this.tickLength=8,this.tickLineWidth=1,this.maxTicks=15,this.tickColour="#b3b3b3",this.tickTextFontSize=10,this.tickTextFont="Arial",this.tickTextColour="black",this.tickRoundingDP=2,this.tickLabels=[]}}class plotSpecification{constructor(){this.colourMap=defaultColourMap,this.titleSpec={titleArray:[],font:"Arial",fontSize:12,verticalSpacing:8,colour:"black"},this.colourBarSpec=new colourBarSpecification,this.boundingBoxColour="#b3b3b3",this.boundingBoxLineWidth=1,this.eraseBackground=!1,this.regionSpec=null,this.drawRegions=!1,this.regionName="",this.regionColour="#262626",this.regionLineWidth=1.25,this.drawLakes=!1,this.lakeColour="#999999",this.lakeLineWidth=1}}function fillOutColourBarSpecification(e){let t=new colourBarSpecification,i=Object.keys(e);for(let s=0;s<i.length;s++)t[i[s]]=e[i[s]];return t}function fillOutPlotSpecification(e){let t=new plotSpecification,i=Object.keys(e);for(let s=0;s<i.length;s++)if("titleSpec"!=i[s]&&"colourBarSpec"!=i[s])t[i[s]]=e[i[s]];else if("titleSpec"==i[s]){let i=Object.keys(e.titleSpec);for(let s=0;s<i.length;s++)t.titleSpec[i[s]]=e.titleSpec[i[s]]}else"colourBarSpec"==i[s]&&(t.colourBarSpec=fillOutColourBarSpecification(e.colourBarSpec));return t}function drawColourBar(e,t,i,s,a,r){let n=fillOutColourBarSpecification(r),o=n.normalisation;const l=n.labelFontSize;e.font=l+"pt "+n.labelFont,e.textBaseline="middle";const h=n.tickLength,_=n.maxTicks;let d,c=n.labelGap,f=n.barThickness,u=s*n.sizeFraction,g=u/a.r.length,p=0,m=0,b=[],w=Math.ceil(a.values.length/_);for(let t=0;t<a.values.length;t+=w)n.tickLabels.length>t?b[t]=n.tickLabels[t]:b[t]=round(a.values[t]*o,n.tickRoundingDP).toString(),p=e.measureText(b[t]).width,p>m&&(m=p);d=""==n.label?f+h+c+m:f+h+2*c+m+2*l;let v=t-d,k=i+s*(1-n.sizeFraction)/2;for(let t=0;t<a.r.length;t++)e.fillStyle="rgb("+a.r[t]+","+a.g[t]+","+a.b[t]+")",e.fillRect(v,u+k-g*(t+1),f,g);e.strokeStyle=n.tickColour,e.lineWidth=n.tickLineWidth,e.font=n.tickTextFontSize+"pt "+n.tickTextFont,e.fillStyle=n.tickTextColour;for(let t=0;t<a.values.length;t+=w)e.beginPath(),e.moveTo(v+f,u+k-g*t),e.lineTo(v+f+h,u+k-g*t),e.stroke(),e.fillText(b[t],v+f+h+c,u+k-g*t);return e.strokeStyle=n.boundingBoxColour,e.lineWidth=n.boundingBoxLineWidth,e.beginPath(),e.rect(v,k,f+1,u+1),e.stroke(),""!=n.label&&(e.font=l+"pt "+n.labelFont,e.fillStyle=n.labelColour,e.textAlign="center",e.translate(v+f+h+2*c+m+l,k+u/2),e.rotate(-Math.PI/2),e.fillText(n.label,0,0),e.resetTransform()),d}function setAspectRatio(e,t,i,s){let a=e[0],r=e[1],n=e[2]-e[0],o=e[3]-e[1];if("equal"==s||"number"==typeof s){let e;e="equal"==s?1:s;let l=e*i*n/t;if(l<o)r+=(o-l)/2,o=l;else{let s=t/e*(o/i);a+=(n-s)/2,n=s}}else"square"==s&&(n<o?(r+=(o-n)/2,o=n):(a+=(n-o)/2,n=o));return[a,r,a+n,r+o]}async function pcolormesh(e,t,i,s,a,r){let n=fillOutPlotSpecification(r);n.eraseBackground&&e.clearRect(t[0],t[1],t[2]-t[0],t[3]-t[1]);let o,l,h=t[0],_=t[1],d=t[2]-t[0],c=t[3]-t[1],f=n.titleSpec.fontSize,u=f+n.titleSpec.verticalSpacing,g=u*n.titleSpec.titleArray.length;e.textAlign="left",e.textBaseline="alphabetic",e.fillStyle=n.titleSpec.colour,e.font=f+"pt "+n.titleSpec.font;for(let t=0;t<n.titleSpec.titleArray.length;t++)e.fillText(n.titleSpec.titleArray[t],h,_+f+u*t);if(n.colourBarSpec.showColourBar){o=drawColourBar(e,h+d,_+g,c-g,n.colourMap,n.colourBarSpec),l=n.colourBarSpec.plotGap}else o=0,l=0;let p=min(i),m=max(i),b=min(s),w=max(s),v=i[1]-i[0],k=[p-v/2,m+v/2],y=s[1]-s[0],x=[b-y/2,w+y/2],z=[h,_+g,h+d-o-l,_+c];if("auto"!=n.aspectRatio){z=setAspectRatio(z,m-p,w-b,n.aspectRatio)}return await drawImageWithColourMap(e,a.flip(0),z[0],z[1],z[2]-z[0],z[3]-z[1],n.colourMap,n.colourBarSpec.normalisation),n.drawRegions&&(null==n.regionSpec?console.log("WARNING: drawRegions == true but regionSpec == null in pcolormesh"):await n.regionSpec.drawRegionList(e,z,x,k,n.regionColour,n.regionLineWidth,n.regionName)),e.strokeStyle=n.boundingBoxColour,e.lineWidth=n.boundingBoxLineWidth,e.beginPath(),e.rect(z[0],z[1],z[2]-z[0],z[3]-z[1]),e.stroke(),z}function DatePlusSeconds(e,t){let i=e.getTime();return new Date(i+1e3*t)}function makeInitialisationTimeStr(e){return"Initialised "+getDateString(e)+" UTC"}function makeValidTimeStr(e,t){let i=e;return"Valid "+getDateString(i)+" to "+getDateString(DatePlusSeconds(i,60*t*60))+" UTC"}function getDateString(e){return e.getUTCFullYear()+"-"+("0"+(e.getUTCMonth()+1)).slice(-2)+"-"+("0"+e.getUTCDate()).slice(-2)+" "+("0"+e.getUTCHours()).slice(-2)+":"+("0"+e.getUTCMinutes()).slice(-2)}function findClosestIdx(e,t){let i=0,s=Math.abs(e[0]-t),a=s;for(let r=1;r<e.length;r++)s=Math.abs(e[r]-t),s<a&&(i=r,a=s);return i}function max(e){let t=e[0];for(let i=1;i<e.length;i++)t<e[i]&&(t=e[i]);return t}function min(e){let t=e[0];for(let i=1;i<e.length;i++)t>e[i]&&(t=e[i]);return t}function ptInRect(e,t){return e[0]>=Math.min(t[0],t[2])&&e[0]<=Math.max(t[0],t[2])&&e[1]>=Math.min(t[1],t[3])&&e[1]<=Math.max(t[1],t[3])}function intersectRect(e,t){return!(Math.min(e[0],e[2])>Math.max(t[0],t[2])||Math.max(e[0],e[2])<Math.min(t[0],t[2])||Math.min(e[1],e[3])>Math.max(t[1],t[3])||Math.max(e[1],e[3])<Math.min(t[1],t[3]))}function lineIntersectsRect(e,t){let i=ptInRect(e[0],t),s=ptInRect(e[1],t);if(i&&s)return{within:!0,intersectionFound:!1,line:[[e[0][0],e[0][1]],[e[1][0],e[1][1]]]};{let a,r,n=[],o=e[0][0],l=e[0][1],h=e[1][0],_=e[1][1];if(o!=h){let e=(_-l)/(h-o),i=l-e*o;a=t[0],r=e*a+i,ptInRect([a,r],[o,l,h,_])&&r>=Math.min(t[1],t[3])&&r<=Math.max(t[1],t[3])&&n.push([a,r]),a=t[2],r=e*a+i,ptInRect([a,r],[o,l,h,_])&&r>=Math.min(t[1],t[3])&&r<=Math.max(t[1],t[3])&&n.push([a,r]),r=t[1],a=(r-i)/e,ptInRect([a,r],[o,l,h,_])&&a>=Math.min(t[0],t[2])&&a<=Math.max(t[0],t[2])&&n.push([a,r]),r=t[3],a=(r-i)/e,ptInRect([a,r],[o,l,h,_])&&a>=Math.min(t[0],t[2])&&a<=Math.max(t[0],t[2])&&n.push([a,r])}else a=o,r=t[1],(r>=l&&r<=_||r>=_&&r<=l)&&a>=Math.min(t[0],t[2])&&a<=Math.max(t[0],t[2])&&n.push([a,r]),a=o,r=t[3],(r>=l&&r<=_||r>=_&&r<=l)&&a>=Math.min(t[0],t[2])&&a<=Math.max(t[0],t[2])&&n.push([a,r]);return 1==n.length?i?(h=n[0][0],_=n[0][1]):(o=n[0][0],l=n[0][1]):n.length>1&&(o=n[0][0],l=n[0][1],h=n[1][0],_=n[1][1]),{within:i||s,intersectionFound:n.length>0,line:[[o,l],[h,_]]}}}const ICPACColourMap={units:"mm/day",values:[0,1/7,10/7,30/7,50/7,100/7,200/7],r:[217,255,255,202,0,108,34],g:[217,165,255,255,254,212,139],b:[217,0,0,112,0,3,34]},KMDColourMap={units:"mm/day",values:[0,1,5,10,15,20,25,30,35,40,50,60,70,80,100],r:[255,62,57,44,26,204,182,143,69,36,255,250,238,238,145],g:[255,246,217,186,143,235,217,194,167,129,200,167,111,0,0],b:[255,0,4,40,26,253,252,229,230,197,0,0,1,5,0]},EMIColourMap={units:"mm/day",values:[0,1,5,10,20,30,50,75,100],r:[217,255,255,202,162,127,102,0,34],g:[217,165,255,255,205,255,205,255,139],b:[217,0,0,112,90,0,0,0,34]},defaultColourMap={units:"mm/day",values:[0,2.4,2.82103008,3.31592136,3.89763096,4.58138952,5.38509912,6.32980296,7.44023568,8.7454704,10.27968192,12.08303856,14.20275696,16.69433592,19.6230108,23.06546064,27.11181696,31.86802272,37.45860576,44.02994088,51.75408024,60.83325936,71.50519224,84.04929408,98.7939984,116.12535504,136.49713872,160.4427288,188.5890756,221.67311496,260.56106232,306.2710932,360],r:[255,255,250,245,241,235,226,216,207,193,175,157,139,120,104,89,73,59,50,41,32,29,31,32,33,34,35,36,36,29,22,15,8],g:[255,255,253,251,249,247,243,239,236,231,223,216,209,202,196,191,185,176,167,158,148,136,123,110,97,85,74,64,53,46,40,34,29],b:[255,217,206,196,186,177,177,178,179,180,182,184,185,187,190,192,194,195,194,193,192,187,181,175,169,163,158,153,148,133,118,103,88]},ICPACProbabilityColourMap={units:"%",values:[0,2.5,25,50,75,100],r:[217,255,255,0,34],g:[217,165,255,254,139],b:[217,0,0,0,34]},KMDProbabilityColourMap={units:"%",values:[0,2.5,25,50,75,100],r:[217,62,36,255,238],g:[217,246,129,200,0],b:[217,0,197,0,5]},EMIProbabilityColourMap={units:"%",values:[0,2.5,25,50,75,100],r:[217,255,255,162,34],g:[217,165,255,205,139],b:[217,0,0,90,34]},defaultProbabilityColourMap={units:"%",values:[0,2.5,25,50,75,100],r:[255,198,64,34,8],g:[255,233,181,93,29],b:[217,180,196,168,88]};function getColourMap(e,t){let i;return t?(i=defaultProbabilityColourMap,"ICPAC"==e?i=ICPACProbabilityColourMap:"KMD"==e?i=KMDProbabilityColourMap:"EMI"==e&&(i=EMIProbabilityColourMap)):(i=defaultColourMap,"ICPAC"==e?i=ICPACColourMap:"KMD"==e?i=KMDColourMap:"EMI"==e&&(i=EMIColourMap)),i}class NDArray{constructor(e,t){this.shape=e.concat(),this.values=t.flat(1/0).concat()}toStringRecursive(e,t){let i="";e.length>0&&(i=Array(t*e.length+1).join(" "));let s=i+"[";if(e.length==this.shape.length-1){let t=0;for(let i=0;i<e.length;i++){let s=1;for(let t=e.length;t>i;t--)s*=this.shape[t];t+=e[i]*s}let i=t+this.shape[e.length];s+=this.values.slice(t,i)}else{s+="\n";for(let i=0;i<this.shape[e.length];i++){let a=e.concat([i]);s+=this.toStringRecursive(a,t)}}return 0==e.length?s+="]":e.length==this.shape.length-1?s+="],\n":s+=i+"],\n",s}toString(){return this.toStringRecursive([],2)}plus(e){let t=new NDArray(this.shape,this.values);if("number"==typeof e)for(let i=0;i<t.values.length;i++)t.values[i]+=e;else for(let i=0;i<t.values.length;i++)t.values[i]+=e.values[i];return t}minus(e){let t=new NDArray(this.shape,this.values);if("number"==typeof e)for(let i=0;i<t.values.length;i++)t.values[i]-=e;else for(let i=0;i<t.values.length;i++)t.values[i]-=e.values[i];return t}times(e){let t=new NDArray(this.shape,this.values);if("number"==typeof e)for(let i=0;i<t.values.length;i++)t.values[i]*=e;else for(let i=0;i<t.values.length;i++)t.values[i]*=e.values[i];return t}divide(e){let t=new NDArray(this.shape,this.values);if("number"==typeof e)for(let i=0;i<t.values.length;i++)t.values[i]/=e;else for(let i=0;i<t.values.length;i++)t.values[i]/=e.values[i];return t}sqrt(){let e=new NDArray(this.shape,this.values);for(let t=0;t<e.values.length;t++)e.values[t]=Math.sqrt(this.values[t]);return e}floor(){let e=new NDArray(this.shape,this.values);for(let t=0;t<e.values.length;t++)e.values[t]=Math.floor(this.values[t]);return e}sum(e){let t=new Array(this.shape.length-1),i=0,s=1;for(let a=0;a<this.shape.length;a++)a!=e&&(t[i]=this.shape[a],i+=1,s*=this.shape[a]);let a=new Array(s);a.fill(0);let r=new NDArray(t,a),n=1;for(let t=e+1;t<this.shape.length;t++)n*=this.shape[t];let o=1;for(let t=0;t<e;t++)o*=this.shape[t];for(let t=0;t<o;t++)for(let i=0;i<this.shape[e];i++)for(let s=0;s<n;s++)r.values[t*n+s]+=this.values[t*this.shape[e]*n+i*n+s];return r}flip(e){let t=new NDArray(this.shape,this.values),i=1;for(let t=e+1;t<this.shape.length;t++)i*=this.shape[t];let s=1;for(let t=0;t<e;t++)s*=this.shape[t];for(let a=0;a<s;a++)for(let s=0;s<this.shape[e];s++)for(let r=0;r<i;r++)t.values[a*this.shape[e]*i+(this.shape[e]-1-s)*i+r]=this.values[a*this.shape[e]*i+s*i+r];return t}moveaxis(e){let t=new NDArray(this.shape,this.values);for(let i=0;i<this.shape.length;i++)t.shape[e[i]]=this.shape[i];let i=[];for(let t=0;t<this.shape.length;t++)i[t]=[e[t],t];i.sort((function(e,t){return e[0]-t[0]}));let s=new Array(this.shape.length);s[i[i.length-1][1]]=1;for(let e=this.shape.length-1;e>0;e--)s[i[e-1][1]]=s[i[e][1]]*t.shape[e];return this.moveaxisRecursive(t,[],s),t}moveaxisRecursive(e,t,i){let s=t.length;if(s==this.shape.length-1){let a=0,r=1,n=0;for(let e=s;e>0;e--)r*=this.shape[e],a+=t[e-1]*r,n+=t[e-1]*i[e-1];for(let t=0;t<this.shape[s];t++)e.values[n+t*i[s]]=this.values[a+t]}else{let a=t.concat();for(let t=0;t<this.shape[s];t++)a[s]=t,this.moveaxisRecursive(e,a,i)}}sort(e){let t=new NDArray(this.shape,this.values),i=1;for(let t=this.shape.length-1;t>e;t--)i*=this.shape[t];let s=new Array(this.shape[e]);for(let a=0;a<i;a++){let r=a;for(let t=0;t<this.shape[e];t++)s[t]=this.values[t*i+r];s.sort();for(let a=0;a<this.shape[e];a++)t.values[a*i+r]=s[a]}return t}copy(){return new NDArray(this.shape,this.values)}squeeze(){let e=[];for(let t=0;t<this.shape.length;t++)this.shape[t]>1&&e.push(this.shape[t]);return new NDArray(e,this.values)}slice(e,t,i){let s=this.shape.concat();s[e]=i-t;let a=1;for(let t=0;t<e;t++)a*=this.shape[t];let r=1;for(let t=e+1;t<s.length;t++)r*=this.shape[t];let n=[];for(let s=0;s<a;s++)n=n.concat(this.values.slice((s*this.shape[e]+t)*r,(s*this.shape[e]+i)*r));return new NDArray(s,n)}}class regionShapes{constructor(){this.regionNames=["Kiambu","Nairobi","Kajiado-East","Moyale","Konso"],this.path="../Shapes",this.countryRegions=[]}async loadJSON(e){console.log("loadJSON("+e+");");const t=await fetch(e);if(!t.ok)throw new Error(`Response status: ${t.status}`);return await t.json()}async loadRegionBorders(e){let t,i=!1;for(let s=0;s<this.regionNames.length;s++)if(this.regionNames[s]==e){i=!0,t=s;break}if(i||console.log("ERROR: Region "+e+" is not in regionShapes.regionNames in regionShapes.loadRegionBorders"),void 0===this.countryRegions[t]){console.log("Loading "+e+" (should happen only once)"),statusUpdate(1,"Loading regions borders ...");let i=this.path+"/"+e+"_boundary.json";this.countryRegions[t]=await this.loadJSON(i),statusUpdate(0,"Regions in "+e+" loaded.")}return t}drawRegion(e,t,i,s,a,r,n){if(intersectRect([a[0],s[0],a[1],s[1]],t.bounding_box)){let o=i[2]-i[0],l=i[3]-i[1],h=s[1]-s[0],_=o/(a[1]-a[0]),d=-l/h,c=i[0]-a[0]*_,f=i[1]-s[1]*d;e.strokeStyle=r,e.lineWidth=n;let u,g,p,m,b=t.line;for(let t=0;t<b.length;t++){let s=!1;for(let a=1;a<b[t][0].length;a++){u=b[t][0][a-1]*_+c,g=b[t][1][a-1]*d+f,p=b[t][0][a]*_+c,m=b[t][1][a]*d+f;let r=lineIntersectsRect([[u,g],[p,m]],i);r.within&&!r.intersectionFound?(0==s&&(s=!0,e.beginPath(),e.moveTo(u,g)),e.lineTo(p,m)):r.intersectionFound&&(u=r.line[0][0],g=r.line[0][1],p=r.line[1][0],m=r.line[1][1],0==s?r.within?(s=!0,e.beginPath(),e.moveTo(u,g),e.lineTo(p,m)):(e.beginPath(),e.moveTo(u,g),e.lineTo(p,m),e.stroke()):(s=!1,e.lineTo(p,m),e.stroke()))}s&&e.stroke()}}}async drawRegionList(e,t,i,s,a,r,n){let o=await this.loadRegionBorders(n);this.drawRegion(e,this.countryRegions[o],t,i,s,a,r)}}let userStatusUpdateFunction,globalRegionSpec=new regionShapes;class ELRData{constructor(){this.dataLoaded=!1,this.regionSpec=globalRegionSpec}async loadELRForecast(e,t,i){statusUpdate(1,"Loading "+e+" ..."),this.dataLoaded=!1;const s=await fetch(e);if(!s.ok)throw new Error(`Response status: ${s.status}`);const a=await s.arrayBuffer();let r=new hdf5.File(a,e),n=24*r.get("time").value;this.time=timeOffsetToDate(n,"2024-04-23T00:00:00Z");let o=r.get("fcst_valid_time").value;this.validTimes=[];for(let e=0;e<o.length;e++)this.validTimes[e]=timeOffsetToDate(24*o[e],"2024-04-24T06:00:00Z");this.thresholds=r.get("threshold").value,this.latitude=r.get("latitude").value,this.longitude=r.get("longitude").value,this.pExceedance=new NDArray(r.get("probability_exceedance").shape,r.get("probability_exceedance").value),this.fileName=e,this.dataLoaded=!0,statusUpdate(0,e+" loaded.")}precipExceedanceProbability(e,t){let i=this.longitude.length,s=this.latitude.length,a=new Array(i*s).fill(0),r=timeOffsetToDate(24*e,"2024-04-23T06:00:00Z"),n=-1;for(let e=0;e<this.validTimes.length;e++)if(this.validTimes[e].getTime()==r.getTime()){n=e;break}-1==n&&console.log("ERROR: validTimeIdx == -1 in ELRData.precipExceedanceProbability()");let o=-1;for(let e=0;e<this.thresholds.length;e++)if(this.thresholds[e].toString(10)==t){o=e;break}-1==o&&console.log("ERROR: thresholdIdx == -1 in ELRData.precipExceedanceProbability()");let l=n*this.pExceedance.shape[2]*s*i;l+=o*s*i;for(let e=0;e<s;e++)for(let t=0;t<i;t++)a[e*i+t]=100*this.pExceedance.values[l+e*i+t];return new NDArray([s,i],a)}async computeLatLonIdxBounds(e){const t=.5;let i,s,a,r,n=await this.regionSpec.loadRegionBorders(e),o=this.regionSpec.countryRegions[n].bounding_box[1]-t,l=this.regionSpec.countryRegions[n].bounding_box[3]+t,h=this.regionSpec.countryRegions[n].bounding_box[0]-t,_=this.regionSpec.countryRegions[n].bounding_box[2]+t;return i=findClosestIdx(this.latitude,o),s=findClosestIdx(this.latitude,l)+1,a=findClosestIdx(this.longitude,h),r=findClosestIdx(this.longitude,_)+1,[i,s,a,r]}async makePlot(e,t,i,s,a,r,n,o,l){statusUpdate(3,"Plotting map ...");let h=fillOutPlotSpecification(r);h.aspectRatio="equal",h.drawRegions=!0,h.drawLakes=!0,h.regionSpec=this.regionSpec;let _=h.regionName;"ICPAC"!=_.toUpperCase()&&"all"!=_.toLowerCase()||(_="East Africa");let[d,c,f,u]=await this.computeLatLonIdxBounds(_);n=n.slice(0,d,c).slice(1,f,u);let g=this.latitude.slice(d,c),p=this.longitude.slice(f,u),m=[l,makeInitialisationTimeStr(this.time),makeValidTimeStr(this.time,24*o+6)];h.titleSpec.titleArray=m;let b=await pcolormesh(e,[t,i,t+s,i+a],p,g,n,h);return statusUpdate(0,"Map plotted."),b}async plotExceedenceProbability(e,t,i,s,a,r,n,o,l,h){let _=new plotSpecification;_.regionName=h,_.colourMap=getColourMap(r,!0);let d=this.precipExceedanceProbability(n,o),c="GAN+ELR forecast for "+o+" mm/day at "+h;for(let e=0;e<l.length;e++)_.colourBarSpec.tickLabels[e]=l[e]+"%";return _.colourBarSpec.showColourBar=!0,_.colourBarSpec.label="Probability of exceedance",_.colourMap.values=l,await this.makePlot(e,t,i,s,a,_,d,n,c)}}function setStatusUpdateFunction(e){userStatusUpdateFunction=e}function statusUpdate(e,t){null!=userStatusUpdateFunction&&userStatusUpdateFunction(e,t)}
